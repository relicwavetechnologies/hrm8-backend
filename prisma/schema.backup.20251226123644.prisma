generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                   String                    @id @default(uuid())
  name                 String
  website              String
  domain               String                    @unique
  countryOrRegion      String                    @default("") @map("country_or_region")
  acceptedTerms        Boolean                   @default(false) @map("accepted_terms")
  verificationStatus   CompanyVerificationStatus @default(PENDING)
  verificationMethod   VerificationMethod?
  verifiedAt           DateTime?
  verifiedBy           String?
  gstNumber            String?
  registrationNumber   String?
  linkedInUrl          String?
  createdAt            DateTime                  @default(now())
  updatedAt            DateTime                  @updatedAt
  regionId             String?                   @map("region_id")
  jobAssignmentMode    JobAssignmentMode         @default(AUTO_RULES_ONLY) @map("job_assignment_mode")
  preferredRecruiterId String?                   @map("preferred_recruiter_id")
  created_by           String?
  licensee_id          String?
  referred_by          String?
  region_owner_type    RegionOwnerType           @default(HRM8)
  commission_status    CommissionStatus          @default(PENDING)
  AccountTeam          AccountTeam[]
  Activity             Activity[]
  Bill                 Bill[]
  region               Region?                   @relation(fields: [regionId], references: [id])
  profile              CompanyProfile?
  CompanySettings      CompanySettings?
  Contact              Contact[]
  EmailTemplate        EmailTemplate[]
  Integration          Integration[]
  invitations          Invitation[]
  jobs                 Job[]
  JobTemplate          JobTemplate[]
  Lead                 Lead[]
  Opportunity          Opportunity[]
  signupRequests       SignupRequest[]
  Subscription         Subscription[]
  users                User[]
  verificationTokens   VerificationToken[]
  priceBookId          String?                   @map("price_book_id")
  priceBook            PriceBook?                @relation(fields: [priceBookId], references: [id])

  @@index([domain])
  @@index([verificationStatus])
  @@index([regionId])
  @@index([created_by])
  @@index([licensee_id])
}

model CompanyProfile {
  id                   String                  @id @default(uuid())
  companyId            String                  @unique @map("company_id")
  status               CompanyProfileStatus    @default(NOT_STARTED)
  completionPercentage Int                     @default(0) @map("completion_percentage")
  completedSections    CompanyProfileSection[] @default([]) @map("completed_sections")
  profileData          Json?                   @map("profile_data")
  lastReminderAt       DateTime?               @map("last_reminder_at")
  skipUntil            DateTime?               @map("skip_until")
  createdAt            DateTime                @default(now()) @map("created_at")
  updatedAt            DateTime                @updatedAt @map("updated_at")
  company              Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model User {
  id                     String               @id @default(uuid())
  email                  String               @unique
  name                   String
  passwordHash           String               @map("password_hash")
  companyId              String               @map("company_id")
  role                   UserRole
  status                 UserStatus           @default(PENDING_VERIFICATION)
  lastLoginAt            DateTime?            @map("last_login_at")
  createdAt              DateTime             @default(now()) @map("created_at")
  updatedAt              DateTime             @updatedAt @map("updated_at")
  assignedBy             String?              @map("assigned_by")
  Assessment             Assessment[]
  AssessmentComment      AssessmentComment[]
  AssessmentGrade        AssessmentGrade[]
  EmailTemplate          EmailTemplate[]
  sentInvitations        Invitation[]         @relation("InvitedBy")
  createdJobs            Job[]                @relation("JobCreator")
  sentJobInvitations     JobInvitation[]      @relation("JobInviter")
  JobTemplate            JobTemplate[]
  OfferLetter            OfferLetter[]
  passwordResetTokens    PasswordResetToken[]
  ScreeningResult        ScreeningResult[]
  sessions               Session[]
  reviewedSignupRequests SignupRequest[]      @relation("ReviewedBy")
  roleAssigner           User?                @relation("RoleAssigner", fields: [assignedBy], references: [id])
  assignedUsers          User[]               @relation("RoleAssigner")
  company                Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([companyId])
  @@index([status])
  @@index([role])
}

model Invitation {
  id         String           @id @default(uuid())
  companyId  String           @map("company_id")
  invitedBy  String           @map("invited_by")
  email      String
  token      String           @unique
  status     InvitationStatus @default(PENDING)
  expiresAt  DateTime         @map("expires_at")
  acceptedAt DateTime?        @map("accepted_at")
  createdAt  DateTime         @default(now()) @map("created_at")
  company    Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  inviter    User             @relation("InvitedBy", fields: [invitedBy], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([companyId])
  @@index([token])
  @@index([status])
  @@index([expiresAt])
}

model Session {
  id           String   @id @default(uuid())
  sessionId    String   @unique @map("session_id")
  userId       String   @map("user_id")
  companyId    String   @map("company_id")
  userRole     UserRole @map("user_role")
  email        String
  expiresAt    DateTime @map("expires_at")
  lastActivity DateTime @default(now()) @map("last_activity")
  createdAt    DateTime @default(now()) @map("created_at")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([userId])
  @@index([companyId])
  @@index([expiresAt])
}

model PasswordResetToken {
  id                 String    @id @default(uuid())
  userId             String    @map("user_id")
  tokenHash          String    @unique @map("token_hash")
  expiresAt          DateTime  @map("expires_at")
  usedAt             DateTime? @map("used_at")
  requestedIp        String?   @map("requested_ip")
  requestedUserAgent String?   @map("requested_user_agent")
  createdAt          DateTime  @default(now()) @map("created_at")
  user               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@index([tokenHash])
}

model VerificationToken {
  id        String    @id @default(uuid())
  companyId String    @map("company_id")
  email     String
  token     String    @unique
  expiresAt DateTime  @map("expires_at")
  usedAt    DateTime? @map("used_at")
  createdAt DateTime  @default(now()) @map("created_at")
  company   Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([email])
  @@index([token])
  @@index([expiresAt])
}

model SignupRequest {
  id              String              @id @default(uuid())
  companyId       String              @map("company_id")
  email           String
  name            String
  firstName       String              @default("") @map("first_name")
  lastName        String              @default("") @map("last_name")
  acceptedTerms   Boolean             @default(false) @map("accepted_terms")
  passwordHash    String              @map("password_hash")
  status          SignupRequestStatus @default(PENDING)
  reviewedBy      String?             @map("reviewed_by")
  reviewedAt      DateTime?           @map("reviewed_at")
  rejectionReason String?             @map("rejection_reason")
  createdAt       DateTime            @default(now()) @map("created_at")
  updatedAt       DateTime            @updatedAt @map("updated_at")
  company         Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  reviewer        User?               @relation("ReviewedBy", fields: [reviewedBy], references: [id])

  @@index([email])
  @@index([companyId])
  @@index([status])
  @@index([createdAt])
}

model Job {
  id                                  String                      @id @default(uuid())
  companyId                           String                      @map("company_id")
  createdBy                           String                      @map("created_by")
  title                               String
  jobCode                             String?                     @map("job_code")
  jobSummary                          String?                     @map("job_summary") @db.VarChar(150)
  category                            String?
  numberOfVacancies                   Int                         @default(1) @map("number_of_vacancies")
  department                          String?
  location                            String
  employmentType                      EmploymentType              @default(FULL_TIME) @map("employment_type")
  workArrangement                     WorkArrangement             @default(ON_SITE) @map("work_arrangement")
  salaryMin                           Float?                      @map("salary_min")
  salaryMax                           Float?                      @map("salary_max")
  salaryCurrency                      String                      @default("USD") @map("salary_currency")
  salaryDescription                   String?                     @map("salary_description")
  description                         String
  status                              JobStatus                   @default(DRAFT)
  stealth                             Boolean                     @default(false)
  postingDate                         DateTime?                   @map("posting_date")
  closeDate                           DateTime?                   @map("close_date")
  createdAt                           DateTime                    @default(now()) @map("created_at")
  updatedAt                           DateTime                    @updatedAt @map("updated_at")
  expiryDate                          DateTime?                   @map("expiry_date")
  featured                            Boolean                     @default(false)
  hiringMode                          HiringMode                  @default(SELF_MANAGED) @map("hiring_mode")
  promotionalTags                     String[]                    @default([]) @map("promotional_tags")
  visibility                          String                      @default("public")
  requirements                        String[]                    @default([])
  responsibilities                    String[]                    @default([])
  termsAccepted                       Boolean                     @default(false) @map("terms_accepted")
  termsAcceptedAt                     DateTime?                   @map("terms_accepted_at")
  termsAcceptedBy                     String?                     @map("terms_accepted_by")
  hiringTeam                          Json?                       @map("hiring_team")
  applicationForm                     Json?                       @map("application_form")
  videoInterviewingEnabled            Boolean                     @default(false) @map("video_interviewing_enabled")
  alertsEnabled                       Json?                       @map("alerts_enabled")
  jobTargetApproved                   Boolean                     @default(false) @map("jobtarget_approved")
  jobTargetBudget                     Float?                      @map("jobtarget_budget")
  jobTargetBudgetSpent                Float?                      @default(0) @map("jobtarget_budget_spent")
  jobTargetChannels                   String[]                    @default([]) @map("jobtarget_channels")
  jobTargetPromotionId                String?                     @map("jobtarget_promotion_id")
  jobTargetStatus                     String?                     @map("jobtarget_status")
  referralLink                        String?                     @map("referral_link")
  savedAsTemplate                     Boolean                     @default(false) @map("saved_as_template")
  shareLink                           String?                     @map("share_link")
  templateId                          String?                     @map("template_id")
  archived                            Boolean                     @default(false) @map("archived")
  archivedAt                          DateTime?                   @map("archived_at")
  archivedBy                          String?                     @map("archived_by")
  automated_screening_enabled         Boolean                     @default(false)
  pre_interview_questionnaire_enabled Boolean                     @default(false)
  screening_criteria                  Json?
  screening_enabled                   Boolean                     @default(false)
  regionId                            String?                     @map("region_id")
  assignedConsultantId                String?                     @map("assigned_consultant_id")
  assignmentMode                      AssignmentMode              @default(AUTO) @map("assignment_mode")
  assignmentSource                    AssignmentSource?           @map("assignment_source")
  paymentStatus                       PaymentStatus?              @default(PENDING) @map("payment_status")
  servicePackage                      String?                     @map("service_package")
  payment_amount                      Float?
  payment_completed_at                DateTime?
  payment_currency                    String?
  payment_failed_at                   DateTime?
  stripe_payment_intent_id            String?
  stripe_session_id                   String?
  applications                        Application[]
  commissions                         Commission[]
  consultantAssignments               ConsultantJobAssignment[]
  conversations                       Conversation[]
  EmailMessage                        EmailMessage[]
  EmailTemplate                       EmailTemplate[]
  assignedConsultant                  Consultant?                 @relation(fields: [assignedConsultantId], references: [id])
  company                             Company                     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  creator                             User                        @relation("JobCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  region                              Region?                     @relation(fields: [regionId], references: [id])
  jobInvitations                      JobInvitation[]
  JobRound                            JobRound[]
  JobTemplate                         JobTemplate[]
  OfferLetter                         OfferLetter[]
  PreInterviewQuestionnaire           PreInterviewQuestionnaire[]
  SavedJob                            SavedJob[]
  ScreeningCriteria                   ScreeningCriteria[]

  @@index([companyId])
  @@index([createdBy])
  @@index([status])
  @@index([hiringMode])
  @@index([expiryDate])
  @@index([regionId])
  @@index([assignedConsultantId])
  @@index([assignmentSource])
}

model Candidate {
  id                      String                    @id @default(uuid())
  email                   String                    @unique
  passwordHash            String                    @map("password_hash")
  firstName               String                    @map("first_name")
  lastName                String                    @map("last_name")
  phone                   String?
  photo                   String?
  linkedInUrl             String?                   @map("linked_in_url")
  city                    String?
  state                   String?
  country                 String?                   @default("United States")
  visaStatus              String?                   @map("visa_status")
  workEligibility         String?                   @map("work_eligibility")
  jobTypePreference       String[]                  @default([]) @map("job_type_preference")
  salaryPreference        Json?                     @map("salary_preference")
  relocationWilling       Boolean?                  @default(false) @map("relocation_willing")
  remotePreference        String?                   @map("remote_preference")
  emailVerified           Boolean                   @default(false) @map("email_verified")
  status                  CandidateStatus           @default(ACTIVE)
  lastLoginAt             DateTime?                 @map("last_login_at")
  createdAt               DateTime                  @default(now()) @map("created_at")
  updatedAt               DateTime                  @updatedAt @map("updated_at")
  resumeUrl               String?                   @map("resume_url")
  applications            Application[]
  certifications          CandidateCertification[]
  coverLetters            CandidateCoverLetter[]
  education               CandidateEducation[]
  portfolioItems          CandidatePortfolio[]
  resumes                 CandidateResume[]
  sessions                CandidateSession[]
  skills                  CandidateSkill[]
  training                CandidateTraining[]
  workExperience          CandidateWorkExperience[]
  jobAlerts               JobAlert[]
  JobInvitation           JobInvitation[]
  notifications           Notification[]
  notificationPreferences NotificationPreferences?
  OfferLetter             OfferLetter[]
  savedJobs               SavedJob[]
  savedSearches           SavedSearch[]

  @@index([email])
  @@index([status])
}

model CandidateSession {
  id           String    @id @default(uuid())
  sessionId    String    @unique @map("session_id")
  candidateId  String    @map("candidate_id")
  email        String
  expiresAt    DateTime  @map("expires_at")
  lastActivity DateTime  @default(now()) @map("last_activity")
  createdAt    DateTime  @default(now()) @map("created_at")
  candidate    Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([candidateId])
  @@index([expiresAt])
}

model SavedJob {
  id          String    @id @default(uuid())
  candidateId String    @map("candidate_id")
  jobId       String    @map("job_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  job         Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([candidateId, jobId])
  @@index([candidateId])
  @@index([jobId])
}

model SavedSearch {
  id             String    @id @default(uuid())
  candidateId    String    @map("candidate_id")
  filters        Json
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  lastSearchedAt DateTime  @default(now()) @map("last_searched_at")
  query          String?
  candidate      Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([lastSearchedAt])
}

model JobAlert {
  id          String    @id @default(uuid())
  candidateId String    @map("candidate_id")
  name        String
  criteria    Json
  frequency   String    @default("DAILY")
  channels    String[]  @default(["EMAIL"])
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([isActive])
}

model Notification {
  id          String           @id @default(uuid())
  candidateId String           @map("candidate_id")
  type        NotificationType
  title       String
  message     String
  data        Json?
  read        Boolean          @default(false)
  readAt      DateTime?        @map("read_at")
  createdAt   DateTime         @default(now()) @map("created_at")
  candidate   Candidate        @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([read])
  @@index([createdAt])
}

model NotificationPreferences {
  id                       String    @id @default(uuid())
  candidateId              String    @unique @map("candidate_id")
  applicationStatusChanges Boolean   @default(true) @map("application_status_changes")
  interviewReminders       Boolean   @default(true) @map("interview_reminders")
  jobMatchAlerts           Boolean   @default(true) @map("job_match_alerts")
  messages                 Boolean   @default(true) @map("messages")
  systemUpdates            Boolean   @default(true) @map("system_updates")
  emailEnabled             Boolean   @default(true) @map("email_enabled")
  inAppEnabled             Boolean   @default(true) @map("in_app_enabled")
  reminderHoursBefore      Int       @default(24) @map("reminder_hours_before")
  createdAt                DateTime  @default(now()) @map("created_at")
  updatedAt                DateTime  @updatedAt @map("updated_at")
  candidate                Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
}

model Conversation {
  id             String                    @id @default(uuid())
  subject        String?
  jobId          String?
  candidateId    String?
  employerUserId String?
  consultantId   String?
  channelType    ConversationChannelType   @default(CANDIDATE_EMPLOYER) @map("channel_type")
  lastMessageId  String?                   @map("last_message_id")
  lastMessageAt  DateTime?                 @map("last_message_at")
  createdAt      DateTime                  @default(now()) @map("created_at")
  updatedAt      DateTime                  @updatedAt @map("updated_at")
  status         ConversationStatus        @default(ACTIVE) @map("status")
  job            Job?                      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  participants   ConversationParticipant[]
  messages       Message[]

  @@index([candidateId])
  @@index([employerUserId])
  @@index([consultantId])
  @@index([jobId])
  @@index([lastMessageAt])
  @@index([status])
}

model ConversationParticipant {
  id               String          @id @default(uuid())
  conversationId   String          @map("conversation_id")
  participantType  ParticipantType @map("participant_type")
  participantId    String          @map("participant_id")
  participantEmail String          @map("participant_email")
  displayName      String?
  createdAt        DateTime        @default(now()) @map("created_at")
  conversation     Conversation    @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([participantId])
  @@index([participantType])
}

model Message {
  id                 String              @id @default(uuid())
  conversationId     String              @map("conversation_id")
  senderType         ParticipantType     @map("sender_type")
  senderId           String              @map("sender_id")
  senderEmail        String              @map("sender_email")
  content            String
  contentType        MessageContentType  @default(TEXT) @map("content_type")
  inReplyToMessageId String?             @map("in_reply_to_message_id")
  readBy             String[]            @default([]) @map("read_by")
  deliveredAt        DateTime?           @map("delivered_at")
  readAt             DateTime?           @map("read_at")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  conversation       Conversation        @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  attachments        MessageAttachment[]

  @@index([conversationId])
  @@index([createdAt])
  @@index([senderId])
}

model MessageAttachment {
  id        String   @id @default(uuid())
  messageId String   @map("message_id")
  fileName  String   @map("file_name")
  fileUrl   String   @map("file_url")
  mimeType  String   @map("mime_type")
  size      Int
  createdAt DateTime @default(now()) @map("created_at")
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
}

model CandidateResume {
  id               String             @id @default(uuid())
  candidateId      String             @map("candidate_id")
  fileName         String             @map("file_name")
  fileUrl          String             @map("file_url")
  fileSize         Int                @map("file_size")
  fileType         String             @map("file_type")
  isDefault        Boolean            @default(false) @map("is_default")
  version          Int                @default(1)
  uploadedAt       DateTime           @default(now()) @map("uploaded_at")
  content          String?
  candidate        Candidate          @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  ResumeAnnotation ResumeAnnotation[]

  @@index([candidateId])
  @@index([isDefault])
}

model CandidateCoverLetter {
  id          String    @id @default(uuid())
  candidateId String    @map("candidate_id")
  title       String
  content     String?
  fileUrl     String?   @map("file_url")
  fileName    String?   @map("file_name")
  fileSize    Int?      @map("file_size")
  fileType    String?   @map("file_type")
  isTemplate  Boolean   @default(false) @map("is_template")
  isDraft     Boolean   @default(true) @map("is_draft")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
}

model CandidatePortfolio {
  id          String    @id @default(uuid())
  candidateId String    @map("candidate_id")
  title       String
  type        String
  fileUrl     String?   @map("file_url")
  fileName    String?   @map("file_name")
  fileSize    Int?      @map("file_size")
  fileType    String?   @map("file_type")
  externalUrl String?   @map("external_url")
  platform    String?
  description String?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
}

model Application {
  id                       String                     @id @default(uuid())
  candidateId              String                     @map("candidate_id")
  jobId                    String                     @map("job_id")
  status                   ApplicationStatus          @default(NEW)
  stage                    ApplicationStage           @default(NEW_APPLICATION)
  appliedDate              DateTime                   @default(now()) @map("applied_date")
  resumeUrl                String?                    @map("resume_url")
  coverLetterUrl           String?                    @map("cover_letter_url")
  portfolioUrl             String?                    @map("portfolio_url")
  linkedInUrl              String?                    @map("linked_in_url")
  websiteUrl               String?                    @map("website_url")
  customAnswers            Json?                      @map("custom_answers")
  questionnaireData        Json?                      @map("questionnaire_data")
  isRead                   Boolean                    @default(false) @map("is_read")
  isNew                    Boolean                    @default(true) @map("is_new")
  tags                     String[]                   @default([])
  createdAt                DateTime                   @default(now()) @map("created_at")
  updatedAt                DateTime                   @updatedAt @map("updated_at")
  addedAt                  DateTime?                  @map("added_at")
  addedBy                  String?                    @map("added_by")
  manuallyAdded            Boolean                    @default(false) @map("manually_added")
  rank                     Int?
  recruiterNotes           String?                    @map("recruiter_notes")
  score                    Float?
  shortlisted              Boolean                    @default(false)
  shortlistedAt            DateTime?                  @map("shortlisted_at")
  shortlistedBy            String?                    @map("shortlisted_by")
  assessmentResults        Json?                      @map("assessment_results")
  automatedScreeningScore  Float?                     @map("automated_screening_score")
  manualScreeningStatus    ManualScreeningStatus?     @map("manual_screening_status")
  screeningNotes           String?                    @map("screening_notes")
  screeningStatus          ScreeningStatus            @default(PENDING) @map("screening_status")
  videoInterviewStatus     VideoInterviewStatus       @default(NOT_SCHEDULED) @map("video_interview_status")
  manualScreeningCompleted Boolean                    @default(false) @map("manual_screening_completed")
  manualScreeningDate      DateTime?                  @map("manual_screening_date")
  manualScreeningScore     Float?                     @map("manual_screening_score")
  aiAnalysis               Json?                      @map("ai_analysis")
  candidate                Candidate                  @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  job                      Job                        @relation(fields: [jobId], references: [id], onDelete: Cascade)
  ApplicationRoundProgress ApplicationRoundProgress[]
  Assessment               Assessment[]
  EmailMessage             EmailMessage[]
  jobInvitation            JobInvitation?
  OfferDocument            OfferDocument[]
  OfferLetter              OfferLetter[]
  QuestionnaireResponse    QuestionnaireResponse[]
  ScreeningResult          ScreeningResult[]
  VideoInterview           VideoInterview[]

  @@unique([candidateId, jobId])
  @@index([candidateId])
  @@index([jobId])
  @@index([status])
  @@index([stage])
  @@index([appliedDate])
  @@index([score])
  @@index([shortlisted])
  @@index([screeningStatus])
}

model JobInvitation {
  id            String              @id @default(uuid())
  jobId         String              @map("job_id")
  candidateId   String?             @map("candidate_id")
  email         String
  token         String              @unique
  status        JobInvitationStatus @default(PENDING)
  invitedBy     String              @map("invited_by")
  expiresAt     DateTime            @map("expires_at")
  acceptedAt    DateTime?           @map("accepted_at")
  applicationId String?             @unique @map("application_id")
  createdAt     DateTime            @default(now()) @map("created_at")
  updatedAt     DateTime            @updatedAt @map("updated_at")
  application   Application?        @relation(fields: [applicationId], references: [id])
  candidate     Candidate?          @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  inviter       User                @relation("JobInviter", fields: [invitedBy], references: [id], onDelete: Cascade)
  job           Job                 @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([jobId, email])
  @@index([email])
  @@index([jobId])
  @@index([candidateId])
  @@index([token])
  @@index([status])
  @@index([expiresAt])
}

model JobTemplate {
  id            String           @id @default(dbgenerated("gen_random_uuid()"))
  company_id    String
  created_by    String
  name          String
  description   String?
  category      TemplateCategory @default(OTHER)
  is_shared     Boolean          @default(false)
  source_job_id String?
  job_data      Json
  usage_count   Int              @default(0)
  last_used_at  DateTime?
  created_at    DateTime         @default(now())
  updated_at    DateTime         @default(now())
  Company       Company          @relation(fields: [company_id], references: [id], onDelete: Cascade)
  User          User             @relation(fields: [created_by], references: [id], onDelete: Cascade)
  Job           Job?             @relation(fields: [source_job_id], references: [id])

  @@index([category])
  @@index([company_id])
  @@index([created_by])
  @@index([is_shared])
  @@index([source_job_id])
}

model Assessment {
  id                 String               @id
  application_id     String
  candidate_id       String
  job_id             String
  assessment_type    AssessmentType
  provider           String?
  status             AssessmentStatus     @default(PENDING_INVITATION)
  invited_by         String
  invited_at         DateTime             @default(now())
  expiry_date        DateTime?
  completed_at       DateTime?
  results            Json?
  pass_threshold     Float?
  cost               Float?               @default(0)
  payment_status     String?              @default("pending")
  notes              String?
  created_at         DateTime             @default(now())
  updated_at         DateTime
  invitation_token   String?              @unique
  job_round_id       String?
  Application        Application          @relation(fields: [application_id], references: [id], onDelete: Cascade)
  User               User                 @relation(fields: [invited_by], references: [id])
  AssessmentComment  AssessmentComment[]
  AssessmentQuestion AssessmentQuestion[]
  AssessmentResponse AssessmentResponse[]

  @@index([application_id])
  @@index([assessment_type])
  @@index([candidate_id])
  @@index([job_id])
  @@index([status])
  @@index([invitation_token])
  @@index([job_round_id])
}

model AssessmentQuestion {
  id                 String               @id
  assessment_id      String
  question_text      String
  question_type      String
  options            Json?
  correct_answer     Json?
  points             Int                  @default(1)
  order              Int                  @default(0)
  created_at         DateTime             @default(now())
  Assessment         Assessment           @relation(fields: [assessment_id], references: [id], onDelete: Cascade)
  AssessmentResponse AssessmentResponse[]

  @@index([assessment_id])
  @@index([order])
}

model AssessmentResponse {
  id                 String              @id
  assessment_id      String
  question_id        String?
  candidate_id       String
  response           Json
  score              Float?
  answered_at        DateTime            @default(now())
  AssessmentGrade    AssessmentGrade[]
  Assessment         Assessment          @relation(fields: [assessment_id], references: [id], onDelete: Cascade)
  AssessmentQuestion AssessmentQuestion? @relation(fields: [question_id], references: [id])

  @@index([assessment_id])
  @@index([candidate_id])
  @@index([question_id])
}

model Commission {
  id               String           @id @default(uuid())
  consultantId     String           @map("consultant_id")
  regionId         String           @map("region_id")
  jobId            String?          @map("job_id")
  type             CommissionType
  amount           Float
  rate             Float?
  description      String?
  status           CommissionStatus @default(PENDING)
  confirmedAt      DateTime?        @map("confirmed_at")
  paidAt           DateTime?        @map("paid_at")
  paymentReference String?          @map("payment_reference")
  notes            String?
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  consultant       Consultant       @relation(fields: [consultantId], references: [id])
  job              Job?             @relation(fields: [jobId], references: [id])
  region           Region           @relation(fields: [regionId], references: [id])

  @@index([consultantId])
  @@index([jobId])
  @@index([regionId])
  @@index([status])
  @@index([type])
}

model Consultant {
  id                       String                     @id @default(uuid())
  email                    String                     @unique
  passwordHash             String                     @map("password_hash")
  firstName                String                     @map("first_name")
  lastName                 String                     @map("last_name")
  phone                    String?
  photo                    String?
  role                     ConsultantRole
  status                   ConsultantStatus           @default(ACTIVE)
  createdAt                DateTime                   @default(now()) @map("created_at")
  updatedAt                DateTime                   @updatedAt @map("updated_at")
  lastLoginAt              DateTime?                  @map("last_login_at")
  address                  String?
  availability             AvailabilityStatus         @default(AVAILABLE)
  averageDaysToFill        Float?                     @map("average_days_to_fill")
  city                     String?
  commissionStructure      String?                    @map("commission_structure")
  country                  String?
  currentEmployers         Int                        @default(0) @map("current_employers")
  currentJobs              Int                        @default(0) @map("current_jobs")
  defaultCommissionRate    Float?                     @map("default_commission_rate")
  industryExpertise        String[]                   @default([]) @map("industry_expertise")
  languages                Json?
  maxEmployers             Int                        @default(10) @map("max_employers")
  maxJobs                  Int                        @default(20) @map("max_jobs")
  paymentMethod            Json?                      @map("payment_method")
  pendingCommissions       Float                      @default(0) @map("pending_commissions")
  regionId                 String                     @map("region_id")
  resumeUrl                String?                    @map("resume_url")
  stateProvince            String?                    @map("state_province")
  successRate              Float                      @default(0) @map("success_rate")
  taxInformation           Json?                      @map("tax_information")
  totalCommissionsPaid     Float                      @default(0) @map("total_commissions_paid")
  totalPlacements          Int                        @default(0) @map("total_placements")
  totalRevenue             Float                      @default(0) @map("total_revenue")
  current_leads            Int                        @default(0)
  max_leads                Int                        @default(20)
  AccountTeam              AccountTeam[]
  commissions              Commission[]
  region                   Region                     @relation(fields: [regionId], references: [id])
  jobAssignments           ConsultantJobAssignment[]
  ConsultantLeadAssignment ConsultantLeadAssignment[]
  sessions                 ConsultantSession[]
  assignedJobs             Job[]
  Lead                     Lead[]
  Opportunity              Opportunity[]
  Subscription             Subscription[]

  @@index([email])
  @@index([regionId])
  @@index([role])
  @@index([status])
  @@index([availability, status, regionId])
}

model ConsultantJobAssignment {
  id                  String            @id @default(uuid())
  consultantId        String            @map("consultant_id")
  jobId               String            @map("job_id")
  assignedAt          DateTime          @default(now()) @map("assigned_at")
  assignedBy          String?           @map("assigned_by")
  status              String            @default("ACTIVE")
  notes               String?
  assignmentSource    AssignmentSource? @map("assignment_source")
  pipeline_note       String?
  pipeline_progress   Int               @default(0)
  pipeline_stage      PipelineStage     @default(INTAKE)
  pipeline_updated_at DateTime?
  pipeline_updated_by String?
  consultant          Consultant        @relation(fields: [consultantId], references: [id], onDelete: Cascade)
  job                 Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([consultantId, jobId])
  @@index([consultantId])
  @@index([jobId])
  @@index([status])
  @@index([pipeline_stage])
}

model ConsultantSession {
  id           String     @id @default(uuid())
  sessionId    String     @unique @map("session_id")
  consultantId String     @map("consultant_id")
  email        String
  expiresAt    DateTime   @map("expires_at")
  lastActivity DateTime   @default(now()) @map("last_activity")
  createdAt    DateTime   @default(now()) @map("created_at")
  consultant   Consultant @relation(fields: [consultantId], references: [id], onDelete: Cascade)

  @@index([consultantId])
  @@index([expiresAt])
  @@index([sessionId])
}

model HRM8Session {
  id           String   @id @default(uuid())
  sessionId    String   @unique @map("session_id")
  hrm8UserId   String   @map("hrm8_user_id")
  email        String
  expiresAt    DateTime @map("expires_at")
  lastActivity DateTime @default(now()) @map("last_activity")
  createdAt    DateTime @default(now()) @map("created_at")
  user         HRM8User @relation(fields: [hrm8UserId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([hrm8UserId])
  @@index([sessionId])
}

model HRM8User {
  id           String         @id @default(uuid())
  email        String         @unique
  passwordHash String         @map("password_hash")
  firstName    String         @map("first_name")
  lastName     String         @map("last_name")
  phone        String?
  photo        String?
  role         HRM8UserRole
  status       HRM8UserStatus @default(ACTIVE)
  licenseeId   String?        @map("licensee_id")
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  lastLoginAt  DateTime?      @map("last_login_at")
  sessions     HRM8Session[]

  @@index([email])
  @@index([licenseeId])
  @@index([role])
  @@index([status])
}

model PreInterviewQuestionnaire {
  id                    String                  @id
  job_id                String
  questions             Json
  auto_generated        Boolean                 @default(false)
  generated_by          String?
  enabled               Boolean                 @default(true)
  created_at            DateTime                @default(now())
  updated_at            DateTime
  Job                   Job                     @relation(fields: [job_id], references: [id], onDelete: Cascade)
  QuestionnaireResponse QuestionnaireResponse[]

  @@index([job_id])
}

model QuestionnaireResponse {
  id                        String                    @id
  questionnaire_id          String
  application_id            String
  candidate_id              String
  responses                 Json
  submitted_at              DateTime                  @default(now())
  score                     Float?
  Application               Application               @relation(fields: [application_id], references: [id], onDelete: Cascade)
  PreInterviewQuestionnaire PreInterviewQuestionnaire @relation(fields: [questionnaire_id], references: [id], onDelete: Cascade)

  @@index([application_id])
  @@index([candidate_id])
  @@index([questionnaire_id])
}

model Region {
  id            String            @id @default(uuid())
  name          String
  code          String            @unique
  country       String
  stateProvince String?           @map("state_province")
  city          String?
  boundaries    Json?
  ownerType     RegionOwnerType   @default(HRM8) @map("owner_type")
  licenseeId    String?           @map("licensee_id")
  isActive      Boolean           @default(true) @map("is_active")
  createdAt     DateTime          @default(now()) @map("created_at")
  updatedAt     DateTime          @updatedAt @map("updated_at")
  commissions   Commission[]
  companies     Company[]
  consultants   Consultant[]
  jobs          Job[]
  Lead          Lead[]
  licensee      RegionalLicensee? @relation(fields: [licenseeId], references: [id])
  revenue       RegionalRevenue[]
  priceBooks    PriceBook[]

  @@index([isActive])
  @@index([licenseeId])
  @@index([ownerType])
}

model RegionalLicensee {
  id                  String            @id @default(uuid())
  name                String
  legalEntityName     String            @map("legal_entity_name")
  email               String
  phone               String?
  address             String?
  city                String?
  state               String?
  country             String?
  taxId               String?           @map("tax_id")
  agreementStartDate  DateTime          @map("agreement_start_date")
  agreementEndDate    DateTime?         @map("agreement_end_date")
  revenueSharePercent Float             @map("revenue_share_percent")
  exclusivity         Boolean           @default(false)
  contractFileUrl     String?           @map("contract_file_url")
  managerContact      String            @map("manager_contact")
  financeContact      String?           @map("finance_contact")
  complianceContact   String?           @map("compliance_contact")
  status              LicenseeStatus    @default(ACTIVE)
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")
  regions             Region[]
  revenueShares       RegionalRevenue[]
  settlements         Settlement[]

  @@index([email])
  @@index([status])
}

model RegionalRevenue {
  id            String            @id @default(uuid())
  regionId      String            @map("region_id")
  licenseeId    String?           @map("licensee_id")
  periodStart   DateTime          @map("period_start")
  periodEnd     DateTime          @map("period_end")
  totalRevenue  Float             @map("total_revenue")
  licenseeShare Float             @map("licensee_share")
  hrm8Share     Float             @map("hrm8_share")
  status        RevenueStatus     @default(PENDING)
  paidAt        DateTime?         @map("paid_at")
  createdAt     DateTime          @default(now()) @map("created_at")
  updatedAt     DateTime          @updatedAt @map("updated_at")
  licensee      RegionalLicensee? @relation(fields: [licenseeId], references: [id])
  region        Region            @relation(fields: [regionId], references: [id])

  @@index([licenseeId])
  @@index([regionId])
  @@index([status])
}

model ScreeningCriteria {
  id              String            @id
  job_id          String
  criteria_type   String
  criteria_config Json?
  enabled         Boolean           @default(true)
  created_at      DateTime          @default(now())
  updated_at      DateTime
  category        String?
  description     String?
  min_score       Int?
  name            String
  required        Boolean           @default(false)
  weight          Float?
  Job             Job               @relation(fields: [job_id], references: [id], onDelete: Cascade)
  ScreeningResult ScreeningResult[]

  @@index([category])
  @@index([criteria_type])
  @@index([job_id])
}

model ScreeningResult {
  id                String                @id
  application_id    String
  screening_type    ScreeningType
  status            ScreeningResultStatus @default(PENDING)
  score             Float?
  criteria_matched  Json?
  reviewed_by       String?
  reviewed_at       DateTime?
  notes             String?
  created_at        DateTime              @default(now())
  updated_at        DateTime
  criteria_id       String?
  passed            Boolean?
  Application       Application           @relation(fields: [application_id], references: [id], onDelete: Cascade)
  ScreeningCriteria ScreeningCriteria?    @relation(fields: [criteria_id], references: [id], onDelete: Cascade)
  User              User?                 @relation(fields: [reviewed_by], references: [id])

  @@unique([application_id, criteria_id])
  @@index([application_id])
  @@index([criteria_id])
  @@index([screening_type])
  @@index([status])
}

model VideoInterview {
  id                     String                   @id @default(uuid())
  applicationId          String                   @map("application_id")
  candidateId            String                   @map("candidate_id")
  jobId                  String                   @map("job_id")
  scheduledDate          DateTime                 @map("scheduled_date")
  duration               Int                      @default(60)
  meetingLink            String?                  @map("meeting_link")
  status                 InterviewStatus          @default(SCHEDULED)
  type                   VideoInterviewType       @default(VIDEO)
  interviewerIds         Json                     @map("interviewer_ids")
  recordingUrl           String?                  @map("recording_url")
  transcript             Json?
  feedback               Json?
  notes                  String?
  createdAt              DateTime                 @default(now()) @map("created_at")
  updatedAt              DateTime                 @updatedAt @map("updated_at")
  cancellation_reason    String?
  is_auto_scheduled      Boolean                  @default(false)
  job_round_id           String?
  no_show_reason         String?
  overall_score          Float?
  rating_criteria_scores Json?
  recommendation         InterviewRecommendation?
  rescheduled_at         DateTime?
  rescheduled_by         String?
  rescheduled_from       String?
  InterviewFeedback      InterviewFeedback[]
  Application            Application              @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  JobRound               JobRound?                @relation(fields: [job_round_id], references: [id])

  @@index([applicationId])
  @@index([candidateId])
  @@index([jobId])
  @@index([scheduledDate])
  @@index([status])
  @@index([is_auto_scheduled])
  @@index([job_round_id])
}

model CandidateCertification {
  id              String    @id
  candidate_id    String
  name            String
  issuing_org     String
  issue_date      DateTime?
  expiry_date     DateTime?
  credential_id   String?
  credential_url  String?
  does_not_expire Boolean   @default(false)
  created_at      DateTime  @default(now())
  updated_at      DateTime
  Candidate       Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
  @@index([expiry_date])
}

model CandidateEducation {
  id           String    @id
  candidate_id String
  institution  String
  degree       String
  field        String
  start_date   DateTime?
  end_date     DateTime?
  current      Boolean   @default(false)
  grade        String?
  description  String?
  created_at   DateTime  @default(now())
  updated_at   DateTime
  Candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
}

model CandidateSkill {
  id           String    @id
  candidate_id String
  name         String
  level        String?
  created_at   DateTime  @default(now())
  Candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
}

model CandidateTraining {
  id              String    @id
  candidate_id    String
  course_name     String
  provider        String
  completed_date  DateTime?
  duration        String?
  description     String?
  certificate_url String?
  created_at      DateTime  @default(now())
  updated_at      DateTime
  Candidate       Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
}

model CandidateWorkExperience {
  id           String    @id
  candidate_id String
  company      String
  role         String
  start_date   DateTime
  end_date     DateTime?
  current      Boolean   @default(false)
  description  String?
  location     String?
  created_at   DateTime  @default(now())
  updated_at   DateTime
  Candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
}

model ApplicationRoundProgress {
  id                 String      @id
  application_id     String
  job_round_id       String
  completed          Boolean     @default(false)
  completed_at       DateTime?
  assessment_id      String?
  video_interview_id String?
  created_at         DateTime    @default(now())
  updated_at         DateTime
  Application        Application @relation(fields: [application_id], references: [id], onDelete: Cascade)
  JobRound           JobRound    @relation(fields: [job_round_id], references: [id], onDelete: Cascade)

  @@unique([application_id, job_round_id])
  @@index([application_id])
  @@index([job_round_id])
}

model AssessmentConfiguration {
  id                     String   @id
  job_round_id           String   @unique
  enabled                Boolean  @default(false)
  autoAssign             Boolean  @default(true)
  deadline_days          Int?
  time_limit_minutes     Int?
  pass_threshold         Float?
  provider               String?
  provider_config        Json?
  assessment_template_id String?
  questions              Json?
  instructions           String?
  created_at             DateTime @default(now())
  updated_at             DateTime
  JobRound               JobRound @relation(fields: [job_round_id], references: [id], onDelete: Cascade)

  @@index([job_round_id])
  @@index([provider])
}

model CompanySettings {
  id         String   @id
  company_id String   @unique
  timezone   String?  @default("UTC")
  workDays   String[] @default(["monday", "tuesday", "wednesday", "thursday", "friday"])
  startTime  String?  @default("09:00")
  endTime    String?  @default("17:00")
  lunchStart String?
  lunchEnd   String?
  created_at DateTime @default(now())
  updated_at DateTime
  Company    Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@index([company_id])
}

model JobRound {
  id                       String                     @id
  job_id                   String
  name                     String
  order                    Int
  type                     JobRoundType
  isFixed                  Boolean                    @default(false)
  fixedKey                 String?
  created_at               DateTime                   @default(now())
  updated_at               DateTime
  ApplicationRoundProgress ApplicationRoundProgress[]
  AssessmentConfiguration  AssessmentConfiguration?
  EmailTemplate            EmailTemplate[]
  EmailTemplateTrigger     EmailTemplateTrigger[]
  InterviewConfiguration   InterviewConfiguration?
  Job                      Job                        @relation(fields: [job_id], references: [id], onDelete: Cascade)
  VideoInterview           VideoInterview[]

  @@index([isFixed])
  @@index([job_id])
  @@index([order])
}

model InterviewConfiguration {
  id                         String          @id
  job_round_id               String          @unique
  enabled                    Boolean         @default(false)
  auto_schedule              Boolean         @default(true)
  require_before_progression Boolean         @default(false)
  require_all_interviewers   Boolean         @default(false)
  interview_format           InterviewFormat @default(LIVE_VIDEO)
  default_duration           Int?            @default(60)
  requires_interviewer       Boolean         @default(true)
  auto_schedule_window_days  Int?
  available_time_slots       Json?
  buffer_time_minutes        Int?
  calendar_integration       String?
  auto_reschedule_on_no_show Boolean         @default(false)
  auto_reschedule_on_cancel  Boolean         @default(false)
  use_custom_criteria        Boolean         @default(false)
  rating_criteria            Json?
  pass_threshold             Float?
  scoring_method             ScoringMethod?
  auto_move_on_pass          Boolean         @default(false)
  pass_criteria              PassCriteria?
  next_round_on_pass_id      String?
  auto_reject_on_fail        Boolean         @default(false)
  fail_criteria              FailCriteria?
  reject_round_id            String?
  requires_manual_review     Boolean         @default(true)
  template_id                String?
  questions                  Json?
  agenda                     String?
  created_at                 DateTime        @default(now())
  updated_at                 DateTime
  assigned_interviewer_ids   String[]        @default([])
  recruiter_email            String?
  recruiter_name             String?
  JobRound                   JobRound        @relation(fields: [job_round_id], references: [id], onDelete: Cascade)

  @@index([job_round_id])
}

model InterviewFeedback {
  id                     String                   @id
  video_interview_id     String
  interviewer_id         String?
  interviewer_name       String
  interviewer_email      String?
  rating_criteria_scores Json?
  overall_rating         Float?
  recommendation         InterviewRecommendation?
  strengths              String?
  concerns               String?
  notes                  String?
  submitted_at           DateTime                 @default(now())
  created_at             DateTime                 @default(now())
  updated_at             DateTime
  VideoInterview         VideoInterview           @relation(fields: [video_interview_id], references: [id], onDelete: Cascade)

  @@index([interviewer_id])
  @@index([submitted_at])
  @@index([video_interview_id])
}

model AccountTeam {
  id            String          @id
  company_id    String
  consultant_id String?
  role          AccountTeamRole
  assigned_at   DateTime        @default(now())
  assigned_by   String
  notes         String?
  created_at    DateTime        @default(now())
  updated_at    DateTime
  Company       Company         @relation(fields: [company_id], references: [id], onDelete: Cascade)
  Consultant    Consultant?     @relation(fields: [consultant_id], references: [id], onDelete: Cascade)

  @@unique([company_id, consultant_id, role])
  @@index([company_id])
  @@index([consultant_id])
}

model Activity {
  id             String       @id
  company_id     String
  lead_id        String?
  opportunity_id String?
  type           ActivityType
  subject        String
  description    String?
  created_by     String
  actor_type     ActorType    @default(CONSULTANT)
  scheduled_at   DateTime?
  completed_at   DateTime?
  due_date       DateTime?
  email_subject  String?
  email_body     String?
  call_duration  Int?
  meeting_link   String?
  tags           String[]
  attachments    Json?
  created_at     DateTime     @default(now())
  updated_at     DateTime
  Company        Company      @relation(fields: [company_id], references: [id], onDelete: Cascade)
  Lead           Lead?        @relation(fields: [lead_id], references: [id], onDelete: Cascade)
  Opportunity    Opportunity? @relation(fields: [opportunity_id], references: [id], onDelete: Cascade)

  @@index([company_id])
  @@index([created_by])
  @@index([lead_id])
  @@index([opportunity_id])
  @@index([scheduled_at])
  @@index([type])
}

model Bill {
  id                String        @id
  subscription_id   String?
  company_id        String
  bill_number       String        @unique
  amount            Float
  currency          String        @default("USD")
  tax_amount        Float?        @default(0)
  total_amount      Float
  status            BillStatus    @default(PENDING)
  due_date          DateTime
  paid_at           DateTime?
  payment_method    String?
  payment_reference String?
  line_items        Json?
  accounting_ref    String?
  synced_at         DateTime?
  notes             String?
  created_at        DateTime      @default(now())
  updated_at        DateTime
  Company           Company       @relation(fields: [company_id], references: [id], onDelete: Cascade)
  Subscription      Subscription? @relation(fields: [subscription_id], references: [id])

  @@index([company_id])
  @@index([due_date])
  @@index([status])
  @@index([subscription_id])
}

model ConsultantLeadAssignment {
  id                String            @id
  consultant_id     String
  lead_id           String
  assigned_at       DateTime          @default(now())
  assigned_by       String?
  status            String            @default("ACTIVE")
  notes             String?
  assignment_source AssignmentSource?
  Consultant        Consultant        @relation(fields: [consultant_id], references: [id], onDelete: Cascade)
  Lead              Lead              @relation(fields: [lead_id], references: [id], onDelete: Cascade)

  @@unique([consultant_id, lead_id])
  @@index([consultant_id])
  @@index([lead_id])
  @@index([status])
}

model Contact {
  id            String   @id
  company_id    String
  first_name    String
  last_name     String
  email         String
  phone         String?
  title         String?
  department    String?
  is_primary    Boolean  @default(false)
  linked_in_url String?
  notes         String?
  created_at    DateTime @default(now())
  updated_at    DateTime
  Company       Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@index([company_id])
  @@index([email])
}

model Integration {
  id            String            @id
  company_id    String?
  type          IntegrationType
  name          String
  status        IntegrationStatus @default(ACTIVE)
  api_key       String?
  api_secret    String?
  login_url     String?
  username      String?
  password      String?
  config        Json?
  last_sync_at  DateTime?
  sync_status   String?
  error_message String?
  created_at    DateTime          @default(now())
  updated_at    DateTime
  Company       Company?          @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@index([company_id])
  @@index([status])
  @@index([type])
}

model Lead {
  id                       String                     @id
  company_name             String
  email                    String
  phone                    String?
  website                  String?
  country                  String
  city                     String?
  state_province           String?
  region_id                String?
  assigned_consultant_id   String?
  assigned_at              DateTime?
  assigned_by              String?
  assignment_mode          AssignmentMode             @default(AUTO)
  assignment_source        AssignmentSource?
  created_by               String?
  referred_by              String?
  lead_source              LeadSource                 @default(WEBSITE)
  status                   LeadStatus                 @default(NEW)
  notes                    String?
  tags                     String[]
  validated_by             String?
  validated_at             DateTime?
  attribution_locked       Boolean                    @default(false)
  converted_to_company_id  String?
  converted_at             DateTime?
  created_at               DateTime                   @default(now())
  updated_at               DateTime
  Activity                 Activity[]
  ConsultantLeadAssignment ConsultantLeadAssignment[]
  Consultant               Consultant?                @relation(fields: [assigned_consultant_id], references: [id])
  Company                  Company?                   @relation(fields: [converted_to_company_id], references: [id])
  Region                   Region?                    @relation(fields: [region_id], references: [id])

  @@index([assigned_consultant_id])
  @@index([assignment_source])
  @@index([converted_to_company_id])
  @@index([created_by])
  @@index([region_id])
  @@index([status])
}

model OfferDocument {
  id             String           @id
  offer_id       String
  application_id String?
  name           String
  description    String?
  category       DocumentCategory
  status         DocumentStatus   @default(PENDING)
  file_url       String?
  file_name      String?
  uploaded_date  DateTime?
  uploaded_by    String?
  reviewed_by    String?
  reviewed_date  DateTime?
  review_notes   String?
  expiry_date    DateTime?
  is_required    Boolean          @default(true)
  template_url   String?
  created_at     DateTime         @default(now())
  updated_at     DateTime
  Application    Application?     @relation(fields: [application_id], references: [id], onDelete: Cascade)
  OfferLetter    OfferLetter      @relation(fields: [offer_id], references: [id], onDelete: Cascade)

  @@index([application_id])
  @@index([category])
  @@index([is_required])
  @@index([offer_id])
  @@index([status])
}

model OfferLetter {
  id                  String             @id
  application_id      String
  candidate_id        String
  job_id              String
  template_id         String?
  offer_type          String
  salary              Float
  salary_currency     String             @default("USD")
  salary_period       String
  start_date          DateTime
  benefits            String[]           @default([])
  bonus_structure     String?
  equity_options      String?
  work_location       String
  work_arrangement    String
  probation_period    Int?
  vacation_days       Int?
  custom_terms        Json?
  status              OfferStatus        @default(DRAFT)
  approval_workflow   Json?
  sent_date           DateTime?
  expiry_date         DateTime?
  responded_date      DateTime?
  decline_reason      String?
  signed_document_url String?
  generated_pdf_url   String?
  custom_message      String?
  created_by          String
  created_at          DateTime           @default(now())
  updated_at          DateTime
  OfferDocument       OfferDocument[]
  Application         Application        @relation(fields: [application_id], references: [id], onDelete: Cascade)
  Candidate           Candidate          @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  User                User               @relation(fields: [created_by], references: [id], onDelete: Cascade)
  Job                 Job                @relation(fields: [job_id], references: [id], onDelete: Cascade)
  OfferNegotiation    OfferNegotiation[]

  @@index([application_id])
  @@index([candidate_id])
  @@index([created_by])
  @@index([expiry_date])
  @@index([job_id])
  @@index([sent_date])
  @@index([status])
}

model OfferNegotiation {
  id               String                 @id
  offer_id         String
  message_type     NegotiationMessageType
  message          String
  proposed_changes Json?
  sender_id        String
  sender_type      String
  sender_name      String
  sender_email     String?
  responded        Boolean                @default(false)
  response         String?
  response_date    DateTime?
  created_at       DateTime               @default(now())
  updated_at       DateTime
  OfferLetter      OfferLetter            @relation(fields: [offer_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([message_type])
  @@index([offer_id])
  @@index([sender_id])
}

model Opportunity {
  id                  String           @id
  company_id          String
  name                String
  type                OpportunityType
  stage               OpportunityStage @default(NEW)
  amount              Float?
  currency            String           @default("USD")
  probability         Int              @default(0)
  expected_close_date DateTime?
  sales_agent_id      String?
  referred_by         String?
  description         String?
  tags                String[]
  lost_reason         String?
  closed_at           DateTime?
  created_at          DateTime         @default(now())
  updated_at          DateTime
  Activity            Activity[]
  Company             Company          @relation(fields: [company_id], references: [id], onDelete: Cascade)
  Consultant          Consultant?      @relation(fields: [sales_agent_id], references: [id])

  @@index([company_id])
  @@index([sales_agent_id])
  @@index([stage])
  @@index([type])
}

model Subscription {
  id               String               @id
  company_id       String
  name             String
  planType         SubscriptionPlanType
  status           SubscriptionStatus   @default(ACTIVE)
  base_price       Float
  currency         String               @default("USD")
  billing_cycle    BillingCycle         @default(MONTHLY)
  discount_percent Float?               @default(0)
  custom_pricing   Json?
  start_date       DateTime
  end_date         DateTime?
  renewal_date     DateTime?
  cancelled_at     DateTime?
  sales_agent_id   String?
  referred_by      String?
  usage_data       Json?
  notes            String?
  created_at       DateTime             @default(now())
  updated_at       DateTime
  Bill             Bill[]
  Company          Company              @relation(fields: [company_id], references: [id], onDelete: Cascade)
  Consultant       Consultant?          @relation(fields: [sales_agent_id], references: [id])

  @@index([company_id])
  @@index([planType])
  @@index([sales_agent_id])
  @@index([status])
}

model AssessmentComment {
  id            String     @id
  assessment_id String
  user_id       String
  comment       String
  created_at    DateTime   @default(now())
  updated_at    DateTime
  Assessment    Assessment @relation(fields: [assessment_id], references: [id], onDelete: Cascade)
  User          User       @relation(fields: [user_id], references: [id])

  @@index([assessment_id])
  @@index([user_id])
}

model AssessmentGrade {
  id                     String             @id
  assessment_response_id String
  user_id                String
  score                  Float?
  comment                String?
  created_at             DateTime           @default(now())
  updated_at             DateTime
  AssessmentResponse     AssessmentResponse @relation(fields: [assessment_response_id], references: [id], onDelete: Cascade)
  User                   User               @relation(fields: [user_id], references: [id])

  @@unique([assessment_response_id, user_id])
  @@index([assessment_response_id])
  @@index([user_id])
}

model EmailMessage {
  id             String         @id
  template_id    String?
  application_id String?
  candidate_id   String
  job_id         String
  job_round_id   String?
  to             String
  cc             String[]       @default([])
  bcc            String[]       @default([])
  subject        String
  body           String
  status         EmailStatus    @default(SENT)
  sent_at        DateTime       @default(now())
  delivered_at   DateTime?
  opened_at      DateTime?
  bounced_at     DateTime?
  error_message  String?
  sender_id      String
  sender_email   String
  Application    Application?   @relation(fields: [application_id], references: [id])
  Job            Job            @relation(fields: [job_id], references: [id], onDelete: Cascade)
  EmailTemplate  EmailTemplate? @relation(fields: [template_id], references: [id])

  @@index([application_id])
  @@index([candidate_id])
  @@index([job_id])
  @@index([job_round_id])
  @@index([sender_id])
  @@index([sent_at])
  @@index([status])
}

model EmailTemplate {
  id                   String                 @id
  company_id           String
  job_id               String?
  job_round_id         String?
  name                 String
  type                 EmailTemplateType
  subject              String
  body                 String
  variables            String[]               @default([])
  is_active            Boolean                @default(true)
  is_default           Boolean                @default(false)
  is_ai_generated      Boolean                @default(false)
  version              Int                    @default(1)
  created_by           String
  created_at           DateTime               @default(now())
  updated_at           DateTime
  EmailMessage         EmailMessage[]
  Company              Company                @relation(fields: [company_id], references: [id], onDelete: Cascade)
  User                 User                   @relation(fields: [created_by], references: [id], onDelete: Cascade)
  Job                  Job?                   @relation(fields: [job_id], references: [id], onDelete: Cascade)
  JobRound             JobRound?              @relation(fields: [job_round_id], references: [id], onDelete: Cascade)
  EmailTemplateTrigger EmailTemplateTrigger[]

  @@index([company_id])
  @@index([created_by])
  @@index([job_id])
  @@index([job_round_id])
  @@index([type])
}

model EmailTemplateTrigger {
  id                String        @id
  template_id       String
  job_round_id      String
  trigger_type      TriggerType
  trigger_condition Json?
  delay_days        Int?          @default(0)
  delay_hours       Int?          @default(0)
  scheduled_time    String?
  is_active         Boolean       @default(true)
  created_at        DateTime      @default(now())
  updated_at        DateTime
  JobRound          JobRound      @relation(fields: [job_round_id], references: [id], onDelete: Cascade)
  EmailTemplate     EmailTemplate @relation(fields: [template_id], references: [id], onDelete: Cascade)

  @@index([job_round_id])
  @@index([template_id])
}

model ResumeAnnotation {
  id              String          @id
  resume_id       String
  user_id         String
  user_name       String
  user_color      String
  type            String
  text            String
  comment         String?
  position        Json
  created_at      DateTime        @default(now())
  CandidateResume CandidateResume @relation(fields: [resume_id], references: [id], onDelete: Cascade)

  @@index([resume_id])
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  USER
  VISITOR
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING_VERIFICATION
  INVITED
}

enum CompanyVerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum CompanyProfileStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

enum CompanyProfileSection {
  BASIC_DETAILS
  PRIMARY_LOCATION
  PERSONAL_PROFILE
  TEAM_MEMBERS
  BILLING
  BRANDING
}

enum VerificationMethod {
  EMAIL_DOMAIN_CHECK
  VERIFICATION_EMAIL
  MANUAL_VERIFICATION
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum JobInvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum SignupRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum JobStatus {
  DRAFT
  OPEN
  CLOSED
  ON_HOLD
  FILLED
  TEMPLATE
  CANCELLED
}

enum HiringMode {
  SELF_MANAGED
  SHORTLISTING
  FULL_SERVICE
  EXECUTIVE_SEARCH
}

enum WorkArrangement {
  ON_SITE
  REMOTE
  HYBRID
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  CASUAL
}

enum TemplateCategory {
  ENGINEERING
  PRODUCT
  DESIGN
  MARKETING
  SALES
  OPERATIONS
  HR
  FINANCE
  EXECUTIVE
  OTHER
}

enum CandidateStatus {
  ACTIVE
  INACTIVE
  PENDING_VERIFICATION
}

enum ApplicationStatus {
  NEW
  SCREENING
  INTERVIEW
  OFFER
  HIRED
  REJECTED
  WITHDRAWN
}

enum ApplicationStage {
  NEW_APPLICATION
  RESUME_REVIEW
  PHONE_SCREEN
  TECHNICAL_INTERVIEW
  ONSITE_INTERVIEW
  OFFER_EXTENDED
  OFFER_ACCEPTED
  REJECTED
}

enum AssessmentStatus {
  PENDING_INVITATION
  INVITED
  IN_PROGRESS
  COMPLETED
  EXPIRED
  CANCELLED
}

enum AssessmentType {
  PERSONALITY
  COGNITIVE
  SKILLS_BASED
  TECHNICAL
  BEHAVIORAL
}

enum AvailabilityStatus {
  AVAILABLE
  AT_CAPACITY
  UNAVAILABLE
}

enum CommissionStatus {
  PENDING
  CONFIRMED
  PAID
  CANCELLED
}

enum CommissionType {
  PLACEMENT
  SUBSCRIPTION_SALE
  RECRUITMENT_SERVICE
  CUSTOM
}

enum ConsultantRole {
  RECRUITER
  SALES_AGENT
  CONSULTANT_360
}

enum ConsultantStatus {
  ACTIVE
  ON_LEAVE
  INACTIVE
  SUSPENDED
}

enum HRM8UserRole {
  GLOBAL_ADMIN
  REGIONAL_LICENSEE
}

enum HRM8UserStatus {
  ACTIVE
  SUSPENDED
  TERMINATED
}

enum InterviewStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
  NO_SHOW
}

enum LicenseeStatus {
  ACTIVE
  SUSPENDED
  TERMINATED
}

enum ManualScreeningStatus {
  PENDING
  PASSED
  FAILED
}

enum RegionOwnerType {
  HRM8
  LICENSEE
}

enum RevenueStatus {
  PENDING
  CONFIRMED
  PAID
}

enum ScreeningResultStatus {
  PASSED
  FAILED
  PENDING
  REVIEW_REQUIRED
}

enum ScreeningStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum ScreeningType {
  AUTOMATED
  MANUAL
}

enum VideoInterviewStatus {
  NOT_SCHEDULED
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum VideoInterviewType {
  PHONE
  VIDEO
  IN_PERSON
  TECHNICAL
  PANEL
}

enum JobRoundType {
  ASSESSMENT
  INTERVIEW
}

enum NotificationType {
  JOB_ALERT
  APPLICATION_UPDATE
  INTERVIEW_SCHEDULED
  MESSAGE
  SYSTEM
}

enum JobAssignmentMode {
  AUTO_RULES_ONLY
  MANUAL_ONLY
}

enum AssignmentMode {
  AUTO
  MANUAL
}

enum AssignmentSource {
  AUTO_RULES
  MANUAL_EMPLOYER
  MANUAL_LICENSEE
  MANUAL_HRM8
}

enum ConversationChannelType {
  CANDIDATE_EMPLOYER
  CANDIDATE_CONSULTANT
  SYSTEM
}

enum ConversationStatus {
  ACTIVE
  ARCHIVED
  CLOSED
}

enum FailCriteria {
  SCORE_BELOW_THRESHOLD
  RECOMMENDATION_NO
  RATING_CRITERIA_FAIL
  COMBINATION
}

enum InterviewFormat {
  LIVE_VIDEO
  PHONE
  IN_PERSON
  PANEL
}

enum InterviewRecommendation {
  STRONG_YES
  YES
  MAYBE
  NO
  STRONG_NO
}

enum MessageContentType {
  TEXT
  FILE
  SYSTEM
}

enum ParticipantType {
  CANDIDATE
  EMPLOYER
  CONSULTANT
  SYSTEM
}

enum PassCriteria {
  SCORE_THRESHOLD
  RECOMMENDATION
  RATING_CRITERIA
  COMBINATION
}

enum ScoringMethod {
  AVERAGE
  WEIGHTED
  CONSENSUS
}

enum PipelineStage {
  INTAKE
  SOURCING
  SCREENING
  SHORTLIST_SENT
  INTERVIEW
  OFFER
  PLACED
  ON_HOLD
  CLOSED
}

enum AccountTeamRole {
  SALES_OWNER
  RECRUITER_OWNER
  REGION_OWNER
}

enum ActivityType {
  EMAIL
  CALL
  MEETING
  NOTE
  TASK
  FOLLOW_UP
}

enum ActorType {
  CONSULTANT
  HRM8_USER
  SYSTEM
}

enum BillStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

enum BillingCycle {
  MONTHLY
  QUARTERLY
  ANNUAL
}

enum DocumentCategory {
  QUALIFICATION
  BACKGROUND_CHECK
  NDA
  IDENTITY
  TAX
  CONTRACT
  BANKING
  COMPLIANCE
  INSURANCE
  OTHER
}

enum DocumentStatus {
  PENDING
  REQUESTED
  SUBMITTED
  APPROVED
  REJECTED
  REVISION_REQUIRED
}

enum IntegrationStatus {
  ACTIVE
  INACTIVE
  ERROR
  PENDING_CONFIG
}

enum IntegrationType {
  JOB_POSTING_PLATFORM
  ASSESSMENT_TOOL
  ACCOUNTING_SYSTEM
  EMAIL_PROVIDER
  CALENDAR
  OTHER
}

enum LeadSource {
  WEBSITE
  MARKETING_CAMPAIGN
  REFERRAL
  PARTNER_IMPORT
  MANUAL_ENTRY
  EVENT
  OTHER
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  CONVERTED
  LOST
  NURTURING
}

enum NegotiationMessageType {
  EMPLOYER_PROPOSAL
  CANDIDATE_COUNTER
  EMPLOYER_REVISION
  CANDIDATE_ACCEPTANCE
  CANDIDATE_DECLINE
}

enum OfferStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  SENT
  UNDER_NEGOTIATION
  ACCEPTED
  DECLINED
  EXPIRED
  WITHDRAWN
}

enum OpportunityStage {
  NEW
  QUALIFICATION
  PROPOSAL
  NEGOTIATION
  CLOSED_WON
  CLOSED_LOST
}

enum OpportunityType {
  SUBSCRIPTION
  RECRUITMENT_SERVICE
  CUSTOM
}

enum SubscriptionPlanType {
  FREE
  BASIC
  PROFESSIONAL
  ENTERPRISE
  CUSTOM
}

enum SubscriptionStatus {
  ACTIVE
  TRIAL
  SUSPENDED
  CANCELLED
  EXPIRED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}


enum EmailStatus {
  SENT
  DELIVERED
  OPENED
  BOUNCED
  FAILED
}

enum EmailTemplateType {
  APPLICATION_CONFIRMATION
  INTERVIEW_INVITATION
  REJECTION
  OFFER_EXTENDED
  OFFER_ACCEPTED
  STAGE_CHANGE
  REMINDER
  FOLLOW_UP
  CUSTOM
}

enum TriggerType {
  IMMEDIATE
  SCHEDULED
  CONDITIONAL
}

model Product {
  id          String   @id @default(uuid())
  name        String
  code        String   @unique
  description String?
  category    String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  tiers       PriceTier[]

  @@index([category])
  @@index([isActive])
}

model PriceBook {
  id          String   @id @default(uuid())
  name        String
  description String?
  isGlobal    Boolean  @default(false) @map("is_global")
  regionId    String?  @map("region_id")
  currency    String   @default("USD")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  region      Region?  @relation(fields: [regionId], references: [id])
  tiers       PriceTier[]
  companies   Company[]

  @@index([regionId])
  @@index([isGlobal])
}

model PriceTier {
  id          String    @id @default(uuid())
  priceBookId String    @map("price_book_id")
  productId   String    @map("product_id")
  name        String
  minQuantity Int       @default(1) @map("min_quantity")
  maxQuantity Int?      @map("max_quantity")
  unitPrice   Float     @map("unit_price")
  period      String    @default("MONTHLY")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  priceBook   PriceBook @relation(fields: [priceBookId], references: [id], onDelete: Cascade)
  product     Product   @relation(fields: [productId], references: [id])

  @@index([priceBookId])
  @@index([productId])
}

model PromoCode {
  id            String   @id @default(uuid())
  code          String   @unique
  description   String?
  discountType  String
  discountValue Float    @map("discount_value")
  startDate     DateTime @map("start_date")
  endDate       DateTime? @map("end_date")
  maxUses       Int?     @map("max_uses")
  usedCount     Int      @default(0) @map("used_count")
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@index([code])
  @@index([isActive])
}

model GlobalIntegration {
  id          String   @id @default(uuid())
  provider    String   @unique
  name        String
  category    String
  apiKey      String?  @map("api_key")
  apiSecret   String?  @map("api_secret")
  endpointUrl String?  @map("endpoint_url")
  config      Json?
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([provider])
}

model Settlement {
  id            String           @id @default(uuid())
  licenseeId    String           @map("licensee_id")
  periodStart   DateTime         @map("period_start")
  periodEnd     DateTime         @map("period_end")
  totalRevenue  Float            @map("total_revenue")
  licenseeShare Float            @map("licensee_share")
  hrm8Share     Float            @map("hrm8_share")
  status        String           @default("PENDING")
  paymentDate   DateTime?        @map("payment_date")
  reference     String?
  generatedAt   DateTime         @default(now()) @map("generated_at")
  licensee      RegionalLicensee @relation(fields: [licenseeId], references: [id])

  @@index([licenseeId])
  @@index([status])
}

model DunningPolicy {
  id            String   @id @default(uuid())
  name          String
  daysOverdue   Int      @map("days_overdue")
  action        String
  emailTemplate String?  @map("email_template")
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
}
