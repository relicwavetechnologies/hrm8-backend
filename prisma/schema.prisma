generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                      String                     @id @default(uuid())
  name                    String
  website                 String
  domain                  String                     @unique
  country_or_region       String                     @default("") @map("country_or_region")
  accepted_terms          Boolean                    @default(false) @map("accepted_terms")
  verification_status     CompanyVerificationStatus  @default(PENDING) @map("verificationStatus")
  verification_method     VerificationMethod?        @map("verificationMethod")
  verified_at             DateTime?                  @map("verifiedAt")
  verified_by             String?                    @map("verifiedBy")
  gst_number              String?                    @map("gstNumber")
  registration_number     String?                    @map("registrationNumber")
  linked_in_url           String?                    @map("linkedInUrl")
  created_at              DateTime                   @default(now()) @map("createdAt")
  updated_at              DateTime                   @default(now()) @updatedAt @map("updatedAt")
  region_id               String?                    @map("region_id")
  job_assignment_mode     JobAssignmentMode          @default(AUTO_RULES_ONLY) @map("job_assignment_mode")
  preferred_recruiter_id  String?                    @map("preferred_recruiter_id")
  created_by              String?
  licensee_id             String?
  region_owner_type       RegionOwnerType            @default(HRM8)
  commission_status       CommissionStatus           @default(PENDING)
  price_book_id           String?                    @map("price_book_id")
  referred_by             String?
  attribution_locked      Boolean                    @default(false) @map("attribution_locked")
  attribution_locked_at   DateTime?                  @map("attribution_locked_at")
  sales_agent_id          String?                    @map("sales_agent_id")
  careers_page_about      String?                    @map("careers_page_about")
  careers_page_banner     String?                    @map("careers_page_banner")
  careers_page_logo       String?                    @map("careers_page_logo")
  careers_page_social     Json?                      @map("careers_page_social")
  careers_page_status     CareersPageStatus          @default(PENDING) @map("careers_page_status")
  careers_pending_changes Json?                      @map("careers_pending_changes")
  careers_review_notes    Json?                      @map("careers_review_notes")
  careers_page_images     Json?                      @map("careers_page_images")
  account_team            AccountTeam[]
  activity                Activity[]
  bill                    Bill[]
  price_book              PriceBook?                 @relation(fields: [price_book_id], references: [id])
  region                  Region?                    @relation(fields: [region_id], references: [id])
  sales_agent             Consultant?                @relation("CompanySalesAgent", fields: [sales_agent_id], references: [id])
  profile                 CompanyProfile?
  company_settings        CompanySettings?
  contact                 Contact[]
  email_template          EmailTemplate[]
  integration             Integration[]
  invitations             Invitation[]
  jobs                    Job[]
  job_template            JobTemplate[]
  lead                    Lead[]
  opportunity             Opportunity[]
  signup_requests         SignupRequest[]
  subscription            Subscription[]
  users                   User[]
  verification_tokens     VerificationToken[]
  conversion_requests     LeadConversionRequest[]
  refund_requests         TransactionRefundRequest[]

  @@index([domain])
  @@index([verification_status])
  @@index([region_id])
  @@index([created_by])
  @@index([licensee_id])
}

model CompanyProfile {
  id                    String                  @id @default(uuid())
  company_id            String                  @unique @map("company_id")
  status                CompanyProfileStatus    @default(NOT_STARTED)
  completion_percentage Int                     @default(0) @map("completion_percentage")
  completed_sections    CompanyProfileSection[] @default([]) @map("completed_sections")
  profile_data          Json?                   @map("profile_data")
  last_reminder_at      DateTime?               @map("last_reminder_at")
  skip_until            DateTime?               @map("skip_until")
  created_at            DateTime                @default(now()) @map("created_at")
  updated_at            DateTime                @default(now()) @updatedAt @map("updated_at")
  company               Company                 @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@index([company_id])
}

model User {
  id                       String                       @id @default(uuid())
  email                    String                       @unique
  name                     String
  password_hash            String                       @map("password_hash")
  company_id               String                       @map("company_id")
  role                     UserRole
  status                   UserStatus                   @default(PENDING_VERIFICATION)
  last_login_at            DateTime?                    @map("last_login_at")
  created_at               DateTime                     @default(now()) @map("created_at")
  updated_at               DateTime                     @default(now()) @updatedAt @map("updated_at")
  assigned_by              String?                      @map("assigned_by")
  assessment               Assessment[]
  assessment_comment       AssessmentComment[]
  assessment_grade         AssessmentGrade[]
  evaluations              CandidateEvaluation[]
  email_template           EmailTemplate[]
  sent_invitations         Invitation[]                 @relation("InvitedBy")
  created_jobs             Job[]                        @relation("JobCreator")
  sent_job_invitations     JobInvitation[]              @relation("JobInviter")
  job_template             JobTemplate[]
  offer_letter             OfferLetter[]
  password_reset_tokens    PasswordResetToken[]
  screening_result         ScreeningResult[]
  sessions                 Session[]
  reviewed_signup_requests SignupRequest[]              @relation("ReviewedBy")
  role_assigner            User?                        @relation("RoleAssigner", fields: [assigned_by], references: [id])
  assigned_users           User[]                       @relation("RoleAssigner")
  company                  Company                      @relation(fields: [company_id], references: [id], onDelete: Cascade)
  hiring_teams             JobHiringTeamMember[]
  alert_rules              UserAlertRule[]              @relation("UserAlertRules")
  notification_preferences UserNotificationPreferences? @relation("UserNotificationPreferences")

  @@index([email])
  @@index([company_id])
  @@index([status])
  @@index([role])
}

model Invitation {
  id          String           @id @default(uuid())
  company_id  String           @map("company_id")
  invited_by  String           @map("invited_by")
  email       String
  token       String           @unique
  status      InvitationStatus @default(PENDING)
  expires_at  DateTime         @map("expires_at")
  accepted_at DateTime?        @map("accepted_at")
  created_at  DateTime         @default(now()) @map("created_at")
  company     Company          @relation(fields: [company_id], references: [id], onDelete: Cascade)
  inviter     User             @relation("InvitedBy", fields: [invited_by], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([company_id])
  @@index([token])
  @@index([status])
  @@index([expires_at])
}

model Session {
  id            String   @id @default(uuid())
  session_id    String   @unique @map("session_id")
  user_id       String   @map("user_id")
  company_id    String   @map("company_id")
  user_role     UserRole @map("user_role")
  email         String
  expires_at    DateTime @map("expires_at")
  last_activity DateTime @default(now()) @map("last_activity")
  created_at    DateTime @default(now()) @map("created_at")
  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([session_id])
  @@index([user_id])
  @@index([company_id])
  @@index([expires_at])
}

model PasswordResetToken {
  id                   String    @id @default(uuid())
  user_id              String    @map("user_id")
  token_hash           String    @unique @map("token_hash")
  expires_at           DateTime  @map("expires_at")
  used_at              DateTime? @map("used_at")
  requested_ip         String?   @map("requested_ip")
  requested_user_agent String?   @map("requested_user_agent")
  created_at           DateTime  @default(now()) @map("created_at")
  user                 User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([expires_at])
  @@index([token_hash])
}

model VerificationToken {
  id         String    @id @default(uuid())
  company_id String    @map("company_id")
  email      String
  token      String    @unique
  expires_at DateTime  @map("expires_at")
  used_at    DateTime? @map("used_at")
  created_at DateTime  @default(now()) @map("created_at")
  company    Company   @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@index([company_id])
  @@index([email])
  @@index([token])
  @@index([expires_at])
}

model SignupRequest {
  id               String              @id @default(uuid())
  company_id       String              @map("company_id")
  email            String
  name             String
  first_name       String              @default("") @map("first_name")
  last_name        String              @default("") @map("last_name")
  accepted_terms   Boolean             @default(false) @map("accepted_terms")
  password_hash    String              @map("password_hash")
  status           SignupRequestStatus @default(PENDING)
  reviewed_by      String?             @map("reviewed_by")
  reviewed_at      DateTime?           @map("reviewed_at")
  rejection_reason String?             @map("rejection_reason")
  created_at       DateTime            @default(now()) @map("created_at")
  updated_at       DateTime            @default(now()) @updatedAt @map("updated_at")
  company          Company             @relation(fields: [company_id], references: [id], onDelete: Cascade)
  reviewer         User?               @relation("ReviewedBy", fields: [reviewed_by], references: [id])

  @@index([email])
  @@index([company_id])
  @@index([status])
  @@index([created_at])
}

model Job {
  id                                  String                      @id @default(uuid())
  company_id                          String                      @map("company_id")
  created_by                          String                      @map("created_by")
  title                               String
  job_code                            String?                     @map("job_code")
  job_summary                         String?                     @map("job_summary") @db.VarChar(150)
  category                            String?
  number_of_vacancies                 Int                         @default(1) @map("number_of_vacancies")
  department                          String?
  location                            String
  employment_type                     EmploymentType              @default(FULL_TIME) @map("employment_type")
  work_arrangement                    WorkArrangement             @default(ON_SITE) @map("work_arrangement")
  salary_min                          Float?                      @map("salary_min")
  salary_max                          Float?                      @map("salary_max")
  salary_currency                     String                      @default("USD") @map("salary_currency")
  salary_description                  String?                     @map("salary_description")
  description                         String
  status                              JobStatus                   @default(DRAFT)
  stealth                             Boolean                     @default(false)
  posting_date                        DateTime?                   @map("posting_date")
  close_date                          DateTime?                   @map("close_date")
  created_at                          DateTime                    @default(now()) @map("created_at")
  updated_at                          DateTime                    @default(now()) @updatedAt @map("updated_at")
  expires_at                          DateTime?                   @map("expiry_date")
  featured                            Boolean                     @default(false)
  hiring_mode                         HiringMode                  @default(SELF_MANAGED) @map("hiring_mode")
  promotional_tags                    String[]                    @default([]) @map("promotional_tags")
  visibility                          String                      @default("public")
  requirements                        String[]                    @default([])
  responsibilities                    String[]                    @default([])
  terms_accepted                      Boolean                     @default(false) @map("terms_accepted")
  terms_accepted_at                   DateTime?                   @map("terms_accepted_at")
  terms_accepted_by                   String?                     @map("terms_accepted_by")
  hiring_team                         Json?                       @map("hiring_team")
  application_form                    Json?                       @map("application_form")
  video_interviewing_enabled          Boolean                     @default(false) @map("video_interviewing_enabled")
  alerts_enabled                      Json?                       @map("alerts_enabled")
  job_target_approved                 Boolean                     @default(false) @map("jobtarget_approved")
  job_target_budget                   Float?                      @map("jobtarget_budget")
  job_target_budget_spent             Float?                      @default(0) @map("jobtarget_budget_spent")
  job_target_channels                 String[]                    @default([]) @map("jobtarget_channels")
  job_target_promotion_id             String?                     @map("jobtarget_promotion_id")
  job_target_status                   String?                     @map("jobtarget_status")
  referral_link                       String?                     @map("referral_link")
  saved_as_template                   Boolean                     @default(false) @map("saved_as_template")
  share_link                          String?                     @map("share_link")
  template_id                         String?                     @map("template_id")
  archived                            Boolean                     @default(false) @map("archived")
  archived_at                         DateTime?                   @map("archived_at")
  archived_by                         String?                     @map("archived_by")
  automated_screening_enabled         Boolean                     @default(false)
  pre_interview_questionnaire_enabled Boolean                     @default(false)
  screening_criteria                  Json?
  screening_enabled                   Boolean                     @default(false)
  region_id                           String?                     @map("region_id")
  assigned_consultant_id              String?                     @map("assigned_consultant_id")
  assignment_mode                     AssignmentMode              @default(AUTO) @map("assignment_mode")
  assignment_source                   AssignmentSource?           @map("assignment_source")
  payment_status                      PaymentStatus?              @default(PENDING) @map("payment_status")
  service_package                     String?                     @map("service_package")
  payment_amount                      Float?
  payment_completed_at                DateTime?
  payment_currency                    String?
  payment_failed_at                   DateTime?
  stripe_payment_intent_id            String?
  stripe_session_id                   String?
  clicks_count                        Int                         @default(0)
  views_count                         Int                         @default(0)
  auto_archive_on_expiry              Boolean                     @default(true) @map("auto_archive_on_expiry")
  posted_at                           DateTime                    @default(now()) @map("posted_at")
  benefits                            String?
  category_id                         String?                     @map("category_id")
  setup_type                          JobSetupType                @default(ADVANCED) @map("setup_type")
  management_type                     String?                     @map("management_type")
  applications                        Application[]
  commissions                         Commission[]
  consultant_assignments              ConsultantJobAssignment[]
  conversations                       Conversation[]
  email_message                       EmailMessage[]
  email_template                      EmailTemplate[]
  assigned_consultant                 Consultant?                 @relation(fields: [assigned_consultant_id], references: [id])
  job_category                        JobCategory?                @relation(fields: [category_id], references: [id])
  company                             Company                     @relation(fields: [company_id], references: [id], onDelete: Cascade)
  creator                             User                        @relation("JobCreator", fields: [created_by], references: [id], onDelete: Cascade)
  region                              Region?                     @relation(fields: [region_id], references: [id])
  job_invitations                     JobInvitation[]
  job_round                           JobRound[]
  job_template                        JobTemplate[]
  offer_letter                        OfferLetter[]
  pre_interview_questionnaire         PreInterviewQuestionnaire[]
  saved_job                           SavedJob[]
  screening_criteria_rel              ScreeningCriteria[]
  job_analytics                       JobAnalytics[]
  team_members                        JobHiringTeamMember[]
  job_roles                           JobRole[]
  tags                                JobTagAssignment[]

  @@index([status, posting_date])
  @@index([category_id])
  @@index([company_id, status])
  @@index([expires_at])
  @@index([company_id])
  @@index([created_by])
  @@index([status])
  @@index([hiring_mode])
  @@index([region_id])
  @@index([assigned_consultant_id])
  @@index([assignment_source])
}

model JobCategory {
  id          String   @id @default(uuid())
  name        String   @unique
  slug        String   @unique
  description String?
  icon        String?
  color       String?
  order       Int      @default(0)
  is_active   Boolean  @default(true) @map("is_active")
  created_at  DateTime @default(now()) @map("created_at")
  updated_at  DateTime @default(now()) @updatedAt @map("updated_at")
  jobs        Job[]

  @@map("job_category")
}

model JobTag {
  id          String             @id @default(uuid())
  name        String             @unique
  slug        String             @unique
  color       String?            @default("#3B82F6")
  description String?
  is_active   Boolean            @default(true) @map("is_active")
  created_at  DateTime           @default(now()) @map("created_at")
  updated_at  DateTime           @default(now()) @updatedAt @map("updated_at")
  jobs        JobTagAssignment[]

  @@map("job_tag")
}

model JobTagAssignment {
  job_id      String
  tag_id      String
  assigned_at DateTime @default(now()) @map("assigned_at")
  job         Job      @relation(fields: [job_id], references: [id], onDelete: Cascade)
  tag         JobTag   @relation(fields: [tag_id], references: [id], onDelete: Cascade)

  @@id([job_id, tag_id])
  @@index([job_id])
  @@index([tag_id])
  @@map("job_tag_assignment")
}

model Candidate {
  id                       String                       @id @default(uuid())
  email                    String                       @unique
  password_hash            String                       @map("password_hash")
  first_name               String                       @map("first_name")
  last_name                String                       @map("last_name")
  phone                    String?
  photo                    String?
  linked_in_url            String?                      @map("linked_in_url")
  city                     String?
  state                    String?
  country                  String?                      @default("United States")
  visa_status              String?                      @map("visa_status")
  work_eligibility         String?                      @map("work_eligibility")
  job_type_preference      String[]                     @default([]) @map("job_type_preference")
  salary_preference        Json?                        @map("salary_preference")
  relocation_willing       Boolean?                     @default(false) @map("relocation_willing")
  remote_preference        String?                      @map("remote_preference")
  email_verified           Boolean                      @default(false) @map("email_verified")
  status                   CandidateStatus              @default(ACTIVE)
  last_login_at            DateTime?                    @map("last_login_at")
  created_at               DateTime                     @default(now()) @map("created_at")
  updated_at               DateTime                     @default(now()) @updatedAt @map("updated_at")
  resume_url               String?                      @map("resume_url")
  applications             Application[]
  certifications           CandidateCertification[]
  cover_letters            CandidateCoverLetter[]
  education                CandidateEducation[]
  portfolio_items          CandidatePortfolio[]
  resumes                  CandidateResume[]
  sessions                 CandidateSession[]
  skills                   CandidateSkill[]
  training                 CandidateTraining[]
  work_experience          CandidateWorkExperience[]
  job_alerts               JobAlert[]
  job_invitation           JobInvitation[]
  notifications            Notification[]
  notification_preferences NotificationPreferences?
  offer_letter             OfferLetter[]
  saved_jobs               SavedJob[]
  saved_searches           SavedSearch[]
  verification_tokens      CandidateVerificationToken[]

  @@index([email])
  @@index([status])
}

model CandidateSession {
  id            String    @id @default(uuid())
  session_id    String    @unique @map("session_id")
  candidate_id  String    @map("candidate_id")
  email         String
  expires_at    DateTime  @map("expires_at")
  last_activity DateTime  @default(now()) @map("last_activity")
  created_at    DateTime  @default(now()) @map("created_at")
  candidate     Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([session_id])
  @@index([candidate_id])
  @@index([expires_at])
}

model CandidateVerificationToken {
  id           String    @id @default(uuid())
  candidate_id String    @map("candidate_id")
  email        String
  token        String    @unique
  expires_at   DateTime  @map("expires_at")
  used_at      DateTime? @map("used_at")
  created_at   DateTime  @default(now()) @map("created_at")
  candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([candidate_id])
  @@map("candidate_verification_tokens")
}

model SavedJob {
  id           String    @id @default(uuid())
  candidate_id String    @map("candidate_id")
  job_id       String    @map("job_id")
  created_at   DateTime  @default(now()) @map("created_at")
  candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  job          Job       @relation(fields: [job_id], references: [id], onDelete: Cascade)

  @@unique([candidate_id, job_id])
  @@index([candidate_id])
  @@index([job_id])
}

model SavedSearch {
  id               String    @id @default(uuid())
  candidate_id     String    @map("candidate_id")
  filters          Json
  created_at       DateTime  @default(now()) @map("created_at")
  updated_at       DateTime  @default(now()) @updatedAt @map("updated_at")
  last_searched_at DateTime  @default(now()) @map("last_searched_at")
  query            String?
  candidate        Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
  @@index([last_searched_at])
}

model JobAlert {
  id           String    @id @default(uuid())
  candidate_id String    @map("candidate_id")
  name         String
  criteria     Json
  frequency    String    @default("DAILY")
  channels     String[]  @default(["EMAIL"])
  is_active    Boolean   @default(true) @map("is_active")
  created_at   DateTime  @default(now()) @map("created_at")
  updated_at   DateTime  @default(now()) @updatedAt @map("updated_at")
  candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
  @@index([is_active])
}

model Notification {
  id           String           @id @default(uuid())
  candidate_id String           @map("candidate_id")
  type         NotificationType
  title        String
  message      String
  data         Json?
  read         Boolean          @default(false)
  read_at      DateTime?        @map("read_at")
  created_at   DateTime         @default(now()) @map("created_at")
  candidate    Candidate        @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
  @@index([read])
  @@index([created_at])
}

model NotificationPreferences {
  id                         String    @id @default(uuid())
  candidate_id               String    @unique @map("candidate_id")
  application_status_changes Boolean   @default(true) @map("application_status_changes")
  interview_reminders        Boolean   @default(true) @map("interview_reminders")
  job_match_alerts           Boolean   @default(true) @map("job_match_alerts")
  messages                   Boolean   @default(true) @map("messages")
  system_updates             Boolean   @default(true) @map("system_updates")
  email_enabled              Boolean   @default(true) @map("email_enabled")
  in_app_enabled             Boolean   @default(true) @map("in_app_enabled")
  reminder_hours_before      Int       @default(24) @map("reminder_hours_before")
  created_at                 DateTime  @default(now()) @map("created_at")
  updated_at                 DateTime  @default(now()) @updatedAt @map("updated_at")
  candidate                  Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
}

model Conversation {
  id               String                    @id @default(uuid())
  subject          String?
  job_id           String?                   @map("jobId")
  candidate_id     String?                   @map("candidateId")
  employer_user_id String?                   @map("employerUserId")
  consultant_id    String?                   @map("consultantId")
  channel_type     ConversationChannelType   @default(CANDIDATE_EMPLOYER) @map("channel_type")
  last_message_id  String?                   @map("last_message_id")
  last_message_at  DateTime?                 @map("last_message_at")
  created_at       DateTime                  @default(now()) @map("created_at")
  updated_at       DateTime                  @default(now()) @updatedAt @map("updated_at")
  status           ConversationStatus        @default(ACTIVE) @map("status")
  job              Job?                      @relation(fields: [job_id], references: [id], onDelete: Cascade)
  participants     ConversationParticipant[]
  messages         Message[]

  @@index([candidate_id])
  @@index([employer_user_id])
  @@index([consultant_id])
  @@index([job_id])
  @@index([last_message_at])
  @@index([status])
}

model ConversationParticipant {
  id                String          @id @default(uuid())
  conversation_id   String          @map("conversation_id")
  participant_type  ParticipantType @map("participant_type")
  participant_id    String          @map("participant_id")
  participant_email String          @map("participant_email")
  display_name      String?         @map("displayName")
  created_at        DateTime        @default(now()) @map("created_at")
  conversation      Conversation    @relation(fields: [conversation_id], references: [id], onDelete: Cascade)

  @@index([conversation_id])
  @@index([participant_id])
  @@index([participant_type])
}

model Message {
  id                     String              @id @default(uuid())
  conversation_id        String              @map("conversation_id")
  sender_type            ParticipantType     @map("sender_type")
  sender_id              String              @map("sender_id")
  sender_email           String              @map("sender_email")
  content                String
  content_type           MessageContentType  @default(TEXT) @map("content_type")
  in_reply_to_message_id String?             @map("in_reply_to_message_id")
  read_by                String[]            @default([]) @map("read_by")
  delivered_at           DateTime?           @map("delivered_at")
  read_at                DateTime?           @map("read_at")
  created_at             DateTime            @default(now()) @map("created_at")
  updated_at             DateTime            @default(now()) @updatedAt @map("updated_at")
  conversation           Conversation        @relation(fields: [conversation_id], references: [id], onDelete: Cascade)
  attachments            MessageAttachment[]

  @@index([conversation_id])
  @@index([created_at])
  @@index([sender_id])
}

model MessageAttachment {
  id         String   @id @default(uuid())
  message_id String   @map("message_id")
  file_name  String   @map("file_name")
  file_url   String   @map("file_url")
  mime_type  String   @map("mime_type")
  size       Int
  created_at DateTime @default(now()) @map("created_at")
  message    Message  @relation(fields: [message_id], references: [id], onDelete: Cascade)

  @@index([message_id])
}

model CandidateResume {
  id                String             @id @default(uuid())
  candidate_id      String             @map("candidate_id")
  file_name         String             @map("file_name")
  file_url          String             @map("file_url")
  file_size         Int                @map("file_size")
  file_type         String             @map("file_type")
  is_default        Boolean            @default(false) @map("is_default")
  version           Int                @default(1)
  uploaded_at       DateTime           @default(now()) @map("uploaded_at")
  content           String?
  candidate         Candidate          @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  resume_annotation ResumeAnnotation[]

  @@index([candidate_id])
  @@index([is_default])
}

model CandidateCoverLetter {
  id           String    @id @default(uuid())
  candidate_id String    @map("candidate_id")
  title        String
  content      String?
  file_url     String?   @map("file_url")
  file_name    String?   @map("file_name")
  file_size    Int?      @map("file_size")
  file_type    String?   @map("file_type")
  is_template  Boolean   @default(false) @map("is_template")
  is_draft     Boolean   @default(true) @map("is_draft")
  created_at   DateTime  @default(now()) @map("created_at")
  updated_at   DateTime  @default(now()) @updatedAt @map("updated_at")
  candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
}

model CandidatePortfolio {
  id           String    @id @default(uuid())
  candidate_id String    @map("candidate_id")
  title        String
  type         String
  file_url     String?   @map("file_url")
  file_name    String?   @map("file_name")
  file_size    Int?      @map("file_size")
  file_type    String?   @map("file_type")
  external_url String?   @map("external_url")
  platform     String?
  description  String?
  created_at   DateTime  @default(now()) @map("created_at")
  updated_at   DateTime  @default(now()) @updatedAt @map("updated_at")
  candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
}

model Application {
  id                         String                     @id @default(uuid())
  candidate_id               String                     @map("candidate_id")
  job_id                     String                     @map("job_id")
  status                     ApplicationStatus          @default(NEW)
  stage                      ApplicationStage           @default(NEW_APPLICATION)
  applied_date               DateTime                   @default(now()) @map("applied_date")
  resume_url                 String?                    @map("resume_url")
  cover_letter_url           String?                    @map("cover_letter_url")
  portfolio_url              String?                    @map("portfolio_url")
  linked_in_url              String?                    @map("linked_in_url")
  website_url                String?                    @map("website_url")
  custom_answers             Json?                      @map("custom_answers")
  questionnaire_data         Json?                      @map("questionnaire_data")
  is_read                    Boolean                    @default(false) @map("is_read")
  is_new                     Boolean                    @default(true) @map("is_new")
  tags                       String[]                   @default([])
  created_at                 DateTime                   @default(now()) @map("created_at")
  updated_at                 DateTime                   @default(now()) @updatedAt @map("updated_at")
  added_at                   DateTime?                  @map("added_at")
  added_by                   String?                    @map("added_by")
  manually_added             Boolean                    @default(false) @map("manually_added")
  rank                       Int?
  recruiter_notes            String?                    @map("recruiter_notes")
  score                      Float?
  shortlisted                Boolean                    @default(false)
  shortlisted_at             DateTime?                  @map("shortlisted_at")
  shortlisted_by             String?                    @map("shortlisted_by")
  assessment_results         Json?                      @map("assessment_results")
  automated_screening_score  Float?                     @map("automated_screening_score")
  manual_screening_status    ManualScreeningStatus?     @map("manual_screening_status")
  screening_notes            String?                    @map("screening_notes")
  screening_status           ScreeningStatus            @default(PENDING) @map("screening_status")
  video_interview_status     VideoInterviewStatus       @default(NOT_SCHEDULED) @map("video_interview_status")
  manual_screening_completed Boolean                    @default(false) @map("manual_screening_completed")
  manual_screening_date      DateTime?                  @map("manual_screening_date")
  manual_screening_score     Float?                     @map("manual_screening_score")
  ai_analysis                Json?                      @map("ai_analysis")
  source                     String?                    @map("source")
  candidate                  Candidate                  @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  job                        Job                        @relation(fields: [job_id], references: [id], onDelete: Cascade)
  application_round_progress ApplicationRoundProgress[]
  assessment                 Assessment[]
  evaluations                CandidateEvaluation[]
  email_message              EmailMessage[]
  job_invitation             JobInvitation?
  offer_document             OfferDocument[]
  offer_letter               OfferLetter[]
  questionnaire_response     QuestionnaireResponse[]
  screening_result           ScreeningResult[]
  video_interview            VideoInterview[]

  @@unique([candidate_id, job_id])
  @@index([candidate_id])
  @@index([job_id])
  @@index([status])
  @@index([stage])
  @@index([applied_date])
  @@index([score])
  @@index([shortlisted])
  @@index([screening_status])
}

model JobInvitation {
  id             String              @id @default(uuid())
  job_id         String              @map("job_id")
  candidate_id   String?             @map("candidate_id")
  email          String
  token          String              @unique
  status         JobInvitationStatus @default(PENDING)
  invited_by     String              @map("invited_by")
  expires_at     DateTime            @map("expires_at")
  accepted_at    DateTime?           @map("accepted_at")
  application_id String?             @unique @map("application_id")
  created_at     DateTime            @default(now()) @map("created_at")
  updated_at     DateTime            @default(now()) @updatedAt @map("updated_at")
  application    Application?        @relation(fields: [application_id], references: [id])
  candidate      Candidate?          @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  inviter        User                @relation("JobInviter", fields: [invited_by], references: [id], onDelete: Cascade)
  job            Job                 @relation(fields: [job_id], references: [id], onDelete: Cascade)

  @@unique([job_id, email])
  @@index([email])
  @@index([job_id])
  @@index([candidate_id])
  @@index([token])
  @@index([status])
  @@index([expires_at])
}

model JobTemplate {
  id            String           @id @default(uuid())
  company_id    String
  created_by    String
  name          String
  description   String?
  category      TemplateCategory @default(OTHER)
  is_shared     Boolean          @default(false)
  source_job_id String?
  job_data      Json
  usage_count   Int              @default(0)
  last_used_at  DateTime?
  created_at    DateTime         @default(now())
  updated_at    DateTime         @default(now()) @updatedAt
  company       Company          @relation(fields: [company_id], references: [id], onDelete: Cascade)
  user          User             @relation(fields: [created_by], references: [id], onDelete: Cascade)
  job           Job?             @relation(fields: [source_job_id], references: [id])

  @@index([category])
  @@index([company_id])
  @@index([created_by])
  @@index([is_shared])
  @@index([source_job_id])
}

model Assessment {
  id                  String               @id @default(uuid())
  application_id      String
  candidate_id        String
  job_id              String
  assessment_type     AssessmentType
  provider            String?
  status              AssessmentStatus     @default(PENDING_INVITATION)
  invited_by          String
  invited_at          DateTime             @default(now())
  expiry_date         DateTime?
  completed_at        DateTime?
  results             Json?
  pass_threshold      Float?
  cost                Float?               @default(0)
  payment_status      String?              @default("pending")
  notes               String?
  created_at          DateTime             @default(now())
  updated_at          DateTime             @default(now()) @updatedAt
  invitation_token    String?              @unique
  job_round_id        String?
  started_at          DateTime?
  application         Application          @relation(fields: [application_id], references: [id], onDelete: Cascade)
  user                User                 @relation(fields: [invited_by], references: [id])
  assessment_comment  AssessmentComment[]
  assessment_question AssessmentQuestion[]
  assessment_response AssessmentResponse[]

  @@index([application_id])
  @@index([assessment_type])
  @@index([candidate_id])
  @@index([job_id])
  @@index([status])
  @@index([invitation_token])
  @@index([job_round_id])
}

model AssessmentQuestion {
  id                  String               @id @default(uuid())
  assessment_id       String
  question_text       String
  question_type       String
  options             Json?
  correct_answer      Json?
  points              Int                  @default(1)
  order               Int                  @default(0)
  created_at          DateTime             @default(now())
  assessment          Assessment           @relation(fields: [assessment_id], references: [id], onDelete: Cascade)
  assessment_response AssessmentResponse[]

  @@index([assessment_id])
  @@index([order])
}

model AssessmentResponse {
  id                  String             @id @default(uuid())
  assessment_id       String
  question_id         String
  candidate_id        String
  response            Json
  score               Float?
  answered_at         DateTime           @default(now())
  assessment_grade    AssessmentGrade[]
  assessment          Assessment         @relation(fields: [assessment_id], references: [id], onDelete: Cascade)
  assessment_question AssessmentQuestion @relation(fields: [question_id], references: [id])

  @@unique([assessment_id, question_id], name: "response_identifier")
  @@index([assessment_id])
  @@index([candidate_id])
}

model Commission {
  id                     String           @id @default(uuid())
  consultant_id          String           @map("consultant_id")
  region_id              String           @map("region_id")
  job_id                 String?          @map("job_id")
  type                   CommissionType
  amount                 Float
  rate                   Float?
  description            String?
  status                 CommissionStatus @default(PENDING)
  confirmed_at           DateTime?        @map("confirmed_at")
  paid_at                DateTime?        @map("paid_at")
  payment_reference      String?          @map("payment_reference")
  notes                  String?
  created_at             DateTime         @default(now()) @map("created_at")
  updated_at             DateTime         @default(now()) @updatedAt @map("updated_at")
  commission_expiry_date DateTime?        @map("commission_expiry_date")
  subscription_id        String?          @map("subscription_id")
  consultant             Consultant       @relation(fields: [consultant_id], references: [id])
  job                    Job?             @relation(fields: [job_id], references: [id])
  region                 Region           @relation(fields: [region_id], references: [id])
  subscription           Subscription?    @relation("SubscriptionCommissions", fields: [subscription_id], references: [id])

  @@index([consultant_id])
  @@index([job_id])
  @@index([subscription_id])
  @@index([region_id])
  @@index([status])
  @@index([type])
}

model CommissionWithdrawal {
  id                     String           @id @default(uuid())
  consultant_id          String           @map("consultant_id")
  amount                 Float
  status                 WithdrawalStatus @default(PENDING)
  payment_method         String           @map("payment_method")
  payment_details        Json?            @map("payment_details")
  commission_ids         String[]         @map("commission_ids")
  processed_by           String?          @map("processed_by")
  processed_at           DateTime?        @map("processed_at")
  payment_reference      String?          @map("payment_reference")
  admin_notes            String?          @map("admin_notes")
  rejection_reason       String?          @map("rejection_reason")
  rejected_at            DateTime?        @map("rejected_at")
  rejected_by            String?          @map("rejected_by")
  notes                  String?
  created_at             DateTime         @default(now()) @map("created_at")
  updated_at             DateTime         @default(now()) @updatedAt @map("updated_at")
  stripe_payout_id       String?          @map("stripe_payout_id")
  stripe_transfer_id     String?          @map("stripe_transfer_id")
  transfer_completed_at  DateTime?        @map("transfer_completed_at")
  transfer_failed_reason String?          @map("transfer_failed_reason")
  transfer_initiated_at  DateTime?        @map("transfer_initiated_at")
  debited_from_wallet    Boolean          @default(false) @map("debited_from_wallet")
  virtual_transaction_id String?          @map("virtual_transaction_id")
  wallet_debit_at        DateTime?        @map("wallet_debit_at")
  consultant             Consultant       @relation("ConsultantWithdrawals", fields: [consultant_id], references: [id])

  @@index([consultant_id])
  @@index([status])
  @@index([created_at])
  @@index([processed_by])
}

model Consultant {
  id                         String                     @id @default(uuid())
  email                      String                     @unique
  password_hash              String                     @map("password_hash")
  first_name                 String                     @map("first_name")
  last_name                  String                     @map("last_name")
  phone                      String?
  photo                      String?
  role                       ConsultantRole
  status                     ConsultantStatus           @default(ACTIVE)
  created_at                 DateTime                   @default(now()) @map("created_at")
  updated_at                 DateTime                   @default(now()) @updatedAt @map("updated_at")
  last_login_at              DateTime?                  @map("last_login_at")
  address                    String?
  availability               AvailabilityStatus         @default(AVAILABLE)
  average_days_to_fill       Float?                     @map("average_days_to_fill")
  city                       String?
  commission_structure       String?                    @map("commission_structure")
  country                    String?
  current_employers          Int                        @default(0) @map("current_employers")
  current_jobs               Int                        @default(0) @map("current_jobs")
  default_commission_rate    Float?                     @map("default_commission_rate")
  industry_expertise         String[]                   @default([]) @map("industry_expertise")
  languages                  Json?
  max_employers              Int                        @default(10) @map("max_employers")
  max_jobs                   Int                        @default(20) @map("max_jobs")
  payment_method             Json?                      @map("payment_method")
  pending_commissions        Float                      @default(0) @map("pending_commissions")
  region_id                  String                     @map("region_id")
  resume_url                 String?                    @map("resume_url")
  state_province             String?                    @map("state_province")
  success_rate               Float                      @default(0) @map("success_rate")
  tax_information            Json?                      @map("tax_information")
  total_commissions_paid     Float                      @default(0) @map("total_commissions_paid")
  total_placements           Int                        @default(0) @map("total_placements")
  total_revenue              Float                      @default(0) @map("total_revenue")
  current_leads              Int                        @default(0)
  max_leads                  Int                        @default(20)
  payout_enabled             Boolean                    @default(false) @map("payout_enabled")
  stripe_account_id          String?                    @map("stripe_account_id")
  stripe_account_status      String?                    @map("stripe_account_status")
  stripe_onboarded_at        DateTime?                  @map("stripe_onboarded_at")
  linkedin_url               String?                    @map("linkedin_url")
  account_team               AccountTeam[]
  commissions                Commission[]
  withdrawals                CommissionWithdrawal[]     @relation("ConsultantWithdrawals")
  sales_companies            Company[]                  @relation("CompanySalesAgent")
  region                     Region                     @relation(fields: [region_id], references: [id])
  job_assignments            ConsultantJobAssignment[]
  consultant_lead_assignment ConsultantLeadAssignment[]
  sessions                   ConsultantSession[]
  integrations               Integration[]
  assigned_jobs              Job[]
  lead                       Lead[]                     @relation("AssignedLeads")
  created_leads              Lead[]                     @relation("CreatedLeads")
  referred_leads             Lead[]                     @relation("ReferredLeads")
  opportunity                Opportunity[]
  subscription               Subscription[]
  conversion_requests        LeadConversionRequest[]    @relation("ConversionRequests")

  @@index([email])
  @@index([region_id])
  @@index([role])
  @@index([status])
  @@index([availability, status, region_id])
}

model ConsultantJobAssignment {
  id                  String            @id @default(uuid())
  consultant_id       String            @map("consultant_id")
  job_id              String            @map("job_id")
  assigned_at         DateTime          @default(now()) @map("assigned_at")
  assigned_by         String?           @map("assigned_by")
  status              String            @default("ACTIVE")
  notes               String?
  assignment_source   AssignmentSource? @map("assignment_source")
  pipeline_note       String?
  pipeline_progress   Int               @default(0)
  pipeline_stage      PipelineStage     @default(INTAKE)
  pipeline_updated_at DateTime?
  pipeline_updated_by String?
  consultant          Consultant        @relation(fields: [consultant_id], references: [id], onDelete: Cascade)
  job                 Job               @relation(fields: [job_id], references: [id], onDelete: Cascade)

  @@unique([consultant_id, job_id])
  @@index([consultant_id])
  @@index([job_id])
  @@index([status])
  @@index([pipeline_stage])
}

model ConsultantSession {
  id            String     @id @default(uuid())
  session_id    String     @unique @map("session_id")
  consultant_id String     @map("consultant_id")
  email         String
  expires_at    DateTime   @map("expires_at")
  last_activity DateTime   @default(now()) @map("last_activity")
  created_at    DateTime   @default(now()) @map("created_at")
  consultant    Consultant @relation(fields: [consultant_id], references: [id], onDelete: Cascade)

  @@index([consultant_id])
  @@index([expires_at])
  @@index([session_id])
}

model HRM8Session {
  id            String   @id @default(uuid())
  session_id    String   @unique @map("session_id")
  hrm8_user_id  String   @map("hrm8_user_id")
  email         String
  expires_at    DateTime @map("expires_at")
  last_activity DateTime @default(now()) @map("last_activity")
  created_at    DateTime @default(now()) @map("created_at")
  user          HRM8User @relation(fields: [hrm8_user_id], references: [id], onDelete: Cascade)

  @@index([expires_at])
  @@index([hrm8_user_id])
  @@index([session_id])
}

model HRM8User {
  id                           String                  @id @default(uuid())
  email                        String                  @unique
  password_hash                String                  @map("password_hash")
  first_name                   String                  @map("first_name")
  last_name                    String                  @map("last_name")
  phone                        String?
  photo                        String?
  role                         HRM8UserRole
  status                       HRM8UserStatus          @default(ACTIVE)
  licensee_id                  String?                 @map("licensee_id")
  created_at                   DateTime                @default(now()) @map("created_at")
  updated_at                   DateTime                @default(now()) @updatedAt @map("updated_at")
  last_login_at                DateTime?               @map("last_login_at")
  sessions                     HRM8Session[]
  integrations                 Integration[]
  reviewed_conversion_requests LeadConversionRequest[] @relation("ReviewedRequests")

  @@index([email])
  @@index([licensee_id])
  @@index([role])
  @@index([status])
}

model PreInterviewQuestionnaire {
  id                     String                  @id @default(uuid())
  job_id                 String
  questions              Json
  auto_generated         Boolean                 @default(false)
  generated_by           String?
  enabled                Boolean                 @default(true)
  created_at             DateTime                @default(now())
  updated_at             DateTime                @default(now()) @updatedAt
  job                    Job                     @relation(fields: [job_id], references: [id], onDelete: Cascade)
  questionnaire_response QuestionnaireResponse[]

  @@index([job_id])
}

model QuestionnaireResponse {
  id                          String                    @id @default(uuid())
  questionnaire_id            String
  application_id              String
  candidate_id                String
  responses                   Json
  submitted_at                DateTime                  @default(now())
  score                       Float?
  application                 Application               @relation(fields: [application_id], references: [id], onDelete: Cascade)
  pre_interview_questionnaire PreInterviewQuestionnaire @relation(fields: [questionnaire_id], references: [id], onDelete: Cascade)

  @@index([application_id])
  @@index([candidate_id])
  @@index([questionnaire_id])
}

model Region {
  id                       String                  @id @default(uuid())
  name                     String
  code                     String                  @unique
  country                  String
  state_province           String?                 @map("state_province")
  city                     String?
  boundaries               Json?
  owner_type               RegionOwnerType         @default(HRM8) @map("owner_type")
  licensee_id              String?                 @map("licensee_id")
  is_active                Boolean                 @default(true) @map("is_active")
  created_at               DateTime                @default(now()) @map("created_at")
  updated_at               DateTime                @default(now()) @updatedAt @map("updated_at")
  monthly_placement_target Int?                    @default(0) @map("monthly_placement_target")
  monthly_revenue_target   Float?                  @default(0) @map("monthly_revenue_target")
  bills                    Bill[]
  commissions              Commission[]
  companies                Company[]
  consultants              Consultant[]
  jobs                     Job[]
  lead                     Lead[]
  price_books              PriceBook[]
  licensee                 RegionalLicensee?       @relation(fields: [licensee_id], references: [id])
  revenue                  RegionalRevenue[]
  conversion_requests      LeadConversionRequest[]

  @@index([is_active])
  @@index([licensee_id])
  @@index([owner_type])
}

model RegionalLicensee {
  id                    String            @id @default(uuid())
  name                  String
  legal_entity_name     String            @map("legal_entity_name")
  email                 String
  phone                 String?
  address               String?
  city                  String?
  state                 String?
  country               String?
  tax_id                String?           @map("tax_id")
  agreement_start_date  DateTime          @map("agreement_start_date")
  agreement_end_date    DateTime?         @map("agreement_end_date")
  revenue_share_percent Float             @map("revenue_share_percent")
  exclusivity           Boolean           @default(false)
  contract_file_url     String?           @map("contract_file_url")
  manager_contact       String            @map("manager_contact")
  finance_contact       String?           @map("finance_contact")
  compliance_contact    String?           @map("compliance_contact")
  status                LicenseeStatus    @default(ACTIVE)
  created_at            DateTime          @default(now()) @map("created_at")
  updated_at            DateTime          @default(now()) @updatedAt @map("updated_at")
  regions               Region[]
  revenue_shares        RegionalRevenue[]
  settlements           Settlement[]

  @@index([email])
  @@index([status])
}

model RegionalRevenue {
  id             String            @id @default(uuid())
  region_id      String            @map("region_id")
  licensee_id    String?           @map("licensee_id")
  period_start   DateTime          @map("period_start")
  period_end     DateTime          @map("period_end")
  total_revenue  Float             @map("total_revenue")
  licensee_share Float             @map("licensee_share")
  hrm8_share     Float             @map("hrm8_share")
  status         RevenueStatus     @default(PENDING)
  paid_at        DateTime?         @map("paid_at")
  created_at     DateTime          @default(now()) @map("created_at")
  updated_at     DateTime          @default(now()) @updatedAt @map("updated_at")
  licensee       RegionalLicensee? @relation(fields: [licensee_id], references: [id])
  region         Region            @relation(fields: [region_id], references: [id])

  @@index([licensee_id])
  @@index([region_id])
  @@index([status])
}

model ScreeningCriteria {
  id               String            @id @default(uuid())
  job_id           String
  criteria_type    String
  criteria_config  Json?
  enabled          Boolean           @default(true)
  created_at       DateTime          @default(now())
  updated_at       DateTime          @default(now()) @updatedAt
  category         String?
  description      String?
  min_score        Int?
  name             String
  required         Boolean           @default(false)
  weight           Float?
  job              Job               @relation(fields: [job_id], references: [id], onDelete: Cascade)
  screening_result ScreeningResult[]

  @@index([category])
  @@index([criteria_type])
  @@index([job_id])
}

model ScreeningResult {
  id                 String                @id @default(uuid())
  application_id     String
  screening_type     ScreeningType
  status             ScreeningResultStatus @default(PENDING)
  score              Float?
  criteria_matched   Json?
  reviewed_by        String?
  reviewed_at        DateTime?
  notes              String?
  created_at         DateTime              @default(now())
  updated_at         DateTime              @default(now()) @updatedAt
  criteria_id        String?
  passed             Boolean?
  application        Application           @relation(fields: [application_id], references: [id], onDelete: Cascade)
  screening_criteria ScreeningCriteria?    @relation(fields: [criteria_id], references: [id], onDelete: Cascade)
  user               User?                 @relation(fields: [reviewed_by], references: [id])

  @@unique([application_id, criteria_id])
  @@index([application_id])
  @@index([criteria_id])
  @@index([screening_type])
  @@index([status])
}

model VideoInterview {
  id                     String                   @id @default(uuid())
  application_id         String                   @map("application_id")
  candidate_id           String                   @map("candidate_id")
  job_id                 String                   @map("job_id")
  scheduled_date         DateTime                 @map("scheduled_date")
  duration               Int                      @default(60)
  meeting_link           String?                  @map("meeting_link")
  status                 InterviewStatus          @default(SCHEDULED)
  type                   VideoInterviewType       @default(VIDEO)
  interviewer_ids        Json                     @map("interviewer_ids")
  recording_url          String?                  @map("recording_url")
  transcript             Json?
  feedback               Json?
  notes                  String?
  created_at             DateTime                 @default(now()) @map("created_at")
  updated_at             DateTime                 @default(now()) @updatedAt @map("updated_at")
  cancellation_reason    String?
  is_auto_scheduled      Boolean                  @default(false)
  job_round_id           String?
  no_show_reason         String?
  overall_score          Float?
  rating_criteria_scores Json?
  recommendation         InterviewRecommendation?
  rescheduled_at         DateTime?
  rescheduled_by         String?
  rescheduled_from       String?
  interview_feedback     InterviewFeedback[]
  application            Application              @relation(fields: [application_id], references: [id], onDelete: Cascade)
  job_round              JobRound?                @relation(fields: [job_round_id], references: [id])

  @@index([application_id])
  @@index([candidate_id])
  @@index([job_id])
  @@index([scheduled_date])
  @@index([status])
  @@index([is_auto_scheduled])
  @@index([job_round_id])
}

model CandidateCertification {
  id              String    @id @default(uuid())
  candidate_id    String
  name            String
  issuing_org     String
  issue_date      DateTime?
  expiry_date     DateTime?
  credential_id   String?
  credential_url  String?
  does_not_expire Boolean   @default(false)
  created_at      DateTime  @default(now())
  updated_at      DateTime  @default(now()) @updatedAt
  candidate       Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
  @@index([expiry_date])
}

model CandidateEducation {
  id           String    @id @default(uuid())
  candidate_id String
  institution  String
  degree       String
  field        String
  start_date   DateTime?
  end_date     DateTime?
  current      Boolean   @default(false)
  grade        String?
  description  String?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @default(now()) @updatedAt
  candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
}

model CandidateSkill {
  id           String    @id @default(uuid())
  candidate_id String
  name         String
  level        String?
  created_at   DateTime  @default(now())
  candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
}

model CandidateTraining {
  id              String    @id @default(uuid())
  candidate_id    String
  course_name     String
  provider        String
  completed_date  DateTime?
  duration        String?
  description     String?
  certificate_url String?
  created_at      DateTime  @default(now())
  updated_at      DateTime  @default(now()) @updatedAt
  candidate       Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
}

model CandidateWorkExperience {
  id           String    @id @default(uuid())
  candidate_id String
  company      String
  role         String
  start_date   DateTime
  end_date     DateTime?
  current      Boolean   @default(false)
  description  String?
  location     String?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @default(now()) @updatedAt
  candidate    Candidate @relation(fields: [candidate_id], references: [id], onDelete: Cascade)

  @@index([candidate_id])
}

model ApplicationRoundProgress {
  id                 String      @id @default(uuid())
  application_id     String
  job_round_id       String
  completed          Boolean     @default(false)
  completed_at       DateTime?
  assessment_id      String?
  video_interview_id String?
  created_at         DateTime    @default(now())
  updated_at         DateTime    @default(now()) @updatedAt
  application        Application @relation(fields: [application_id], references: [id], onDelete: Cascade)
  job_round          JobRound    @relation(fields: [job_round_id], references: [id], onDelete: Cascade)

  @@unique([application_id, job_round_id])
  @@index([application_id])
  @@index([job_round_id])
}

model AssessmentConfiguration {
  id                      String   @id @default(uuid())
  job_round_id            String   @unique
  enabled                 Boolean  @default(false)
  auto_assign             Boolean  @default(true) @map("autoAssign")
  deadline_days           Int?
  time_limit_minutes      Int?
  pass_threshold          Float?
  provider                String?
  provider_config         Json?
  assessment_template_id  String?
  questions               Json?
  instructions            String?
  created_at              DateTime @default(now())
  updated_at              DateTime @default(now()) @updatedAt
  auto_move_on_pass       Boolean  @default(false)
  auto_reject_on_deadline Boolean  @default(false)
  auto_reject_on_fail     Boolean  @default(false)
  job_round               JobRound @relation(fields: [job_round_id], references: [id], onDelete: Cascade)

  @@index([job_round_id])
  @@index([provider])
}

model CompanySettings {
  id          String   @id @default(uuid())
  company_id  String   @unique
  timezone    String?  @default("UTC")
  work_days   String[] @default(["monday", "tuesday", "wednesday", "thursday", "friday"]) @map("workDays")
  start_time  String?  @default("09:00") @map("startTime")
  end_time    String?  @default("17:00") @map("endTime")
  lunch_start String?  @map("lunchStart")
  lunch_end   String?  @map("lunchEnd")
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now()) @updatedAt
  company     Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@index([company_id])
}

model JobRole {
  id           String                    @id @default(uuid())
  job_id       String                    @map("job_id")
  name         String
  is_default   Boolean                   @default(false) @map("is_default")
  created_at   DateTime                  @default(now()) @map("created_at")
  job_rounds   JobRound[]
  member_roles JobHiringTeamMemberRole[]
  job          Job                       @relation(fields: [job_id], references: [id], onDelete: Cascade)

  @@index([job_id])
  @@map("job_role")
}

model JobRound {
  id                         String                     @id @default(uuid())
  job_id                     String                     @map("job_id")
  name                       String
  order                      Int
  type                       JobRoundType
  is_fixed                   Boolean                    @default(false) @map("isFixed")
  fixed_key                  String?                    @map("fixedKey")
  created_at                 DateTime                   @default(now())
  updated_at                 DateTime                   @default(now()) @updatedAt
  email_config               Json?                      @map("email_config")
  assigned_role_id           String?                    @map("assigned_role_id")
  auto_move_on_pass          Boolean                    @default(false) @map("auto_move_on_pass")
  application_round_progress ApplicationRoundProgress[]
  assessment_configuration   AssessmentConfiguration?
  email_template             EmailTemplate[]
  email_template_trigger     EmailTemplateTrigger[]
  interview_configuration    InterviewConfiguration?
  assigned_role              JobRole?                   @relation(fields: [assigned_role_id], references: [id])
  job                        Job                        @relation(fields: [job_id], references: [id], onDelete: Cascade)
  video_interview            VideoInterview[]

  @@index([is_fixed])
  @@index([job_id])
  @@index([order])
  @@index([assigned_role_id])
}

model InterviewConfiguration {
  id                         String          @id @default(uuid())
  job_round_id               String          @unique
  enabled                    Boolean         @default(false)
  auto_schedule              Boolean         @default(true)
  require_before_progression Boolean         @default(false)
  require_all_interviewers   Boolean         @default(false)
  interview_format           InterviewFormat @default(LIVE_VIDEO)
  default_duration           Int?            @default(60)
  requires_interviewer       Boolean         @default(true)
  auto_schedule_window_days  Int?
  available_time_slots       Json?
  buffer_time_minutes        Int?
  calendar_integration       String?
  auto_reschedule_on_no_show Boolean         @default(false)
  auto_reschedule_on_cancel  Boolean         @default(false)
  use_custom_criteria        Boolean         @default(false)
  rating_criteria            Json?
  pass_threshold             Float?
  scoring_method             ScoringMethod?
  auto_move_on_pass          Boolean         @default(false)
  pass_criteria              PassCriteria?
  next_round_on_pass_id      String?
  auto_reject_on_fail        Boolean         @default(false)
  fail_criteria              FailCriteria?
  reject_round_id            String?
  requires_manual_review     Boolean         @default(true)
  template_id                String?
  questions                  Json?
  agenda                     String?
  created_at                 DateTime        @default(now())
  updated_at                 DateTime        @default(now()) @updatedAt
  assigned_interviewer_ids   String[]        @default([])
  job_round                  JobRound        @relation(fields: [job_round_id], references: [id], onDelete: Cascade)

  @@index([job_round_id])
}

model InterviewFeedback {
  id                     String                   @id @default(uuid())
  video_interview_id     String
  interviewer_id         String?
  interviewer_name       String
  interviewer_email      String?
  rating_criteria_scores Json?
  overall_rating         Float?
  recommendation         InterviewRecommendation?
  strengths              String?
  concerns               String?
  notes                  String?
  submitted_at           DateTime                 @default(now())
  created_at             DateTime                 @default(now())
  updated_at             DateTime                 @default(now()) @updatedAt
  video_interview        VideoInterview           @relation(fields: [video_interview_id], references: [id], onDelete: Cascade)

  @@index([interviewer_id])
  @@index([submitted_at])
  @@index([video_interview_id])
}

model AccountTeam {
  id            String          @id @default(uuid())
  company_id    String
  consultant_id String?
  role          AccountTeamRole
  assigned_at   DateTime        @default(now())
  assigned_by   String
  notes         String?
  created_at    DateTime        @default(now())
  updated_at    DateTime        @default(now()) @updatedAt
  company       Company         @relation(fields: [company_id], references: [id], onDelete: Cascade)
  consultant    Consultant?     @relation(fields: [consultant_id], references: [id], onDelete: Cascade)

  @@unique([company_id, consultant_id, role])
  @@index([company_id])
  @@index([consultant_id])
}

model Activity {
  id             String       @id @default(uuid())
  company_id     String
  lead_id        String?
  opportunity_id String?
  type           ActivityType
  subject        String
  description    String?
  created_by     String
  actor_type     ActorType    @default(CONSULTANT)
  scheduled_at   DateTime?
  completed_at   DateTime?
  due_date       DateTime?
  email_subject  String?
  email_body     String?
  call_duration  Int?
  meeting_link   String?
  tags           String[]
  attachments    Json?
  created_at     DateTime     @default(now())
  updated_at     DateTime     @default(now()) @updatedAt
  company        Company      @relation(fields: [company_id], references: [id], onDelete: Cascade)
  lead           Lead?        @relation(fields: [lead_id], references: [id], onDelete: Cascade)
  opportunity    Opportunity? @relation(fields: [opportunity_id], references: [id], onDelete: Cascade)

  @@index([company_id])
  @@index([created_by])
  @@index([lead_id])
  @@index([opportunity_id])
  @@index([scheduled_at])
  @@index([type])
}

model Bill {
  id                String        @id @default(uuid())
  subscription_id   String?
  company_id        String
  bill_number       String        @unique
  amount            Float
  currency          String        @default("USD")
  tax_amount        Float?        @default(0)
  total_amount      Float
  status            BillStatus    @default(PENDING)
  due_date          DateTime
  paid_at           DateTime?
  payment_method    String?
  payment_reference String?
  line_items        Json?
  accounting_ref    String?
  synced_at         DateTime?
  notes             String?
  created_at        DateTime      @default(now()) @map("created_at")
  updated_at        DateTime      @default(now()) @updatedAt @map("updated_at")
  region_id         String?       @map("region_id")
  company           Company       @relation(fields: [company_id], references: [id], onDelete: Cascade)
  region            Region?       @relation(fields: [region_id], references: [id])
  subscription      Subscription? @relation(fields: [subscription_id], references: [id])

  @@index([company_id])
  @@index([due_date])
  @@index([status])
  @@index([subscription_id])
  @@index([region_id])
}

model ConsultantLeadAssignment {
  id                String            @id @default(uuid())
  consultant_id     String
  lead_id           String
  assigned_at       DateTime          @default(now())
  assigned_by       String?
  status            String            @default("ACTIVE")
  notes             String?
  assignment_source AssignmentSource?
  consultant        Consultant        @relation(fields: [consultant_id], references: [id], onDelete: Cascade)
  lead              Lead              @relation(fields: [lead_id], references: [id], onDelete: Cascade)

  @@unique([consultant_id, lead_id])
  @@index([consultant_id])
  @@index([lead_id])
  @@index([status])
}

model Contact {
  id            String   @id @default(uuid())
  company_id    String
  first_name    String
  last_name     String
  email         String
  phone         String?
  title         String?
  department    String?
  is_primary    Boolean  @default(false)
  linked_in_url String?
  notes         String?
  created_at    DateTime @default(now())
  updated_at    DateTime @default(now()) @updatedAt
  company       Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@index([company_id])
  @@index([email])
}

model Integration {
  id                    String            @id @default(uuid())
  company_id            String?
  type                  IntegrationType
  name                  String
  status                IntegrationStatus @default(ACTIVE)
  api_key               String?
  api_secret            String?
  login_url             String?
  username              String?
  password              String?
  config                Json?
  last_sync_at          DateTime?
  sync_status           String?
  error_message         String?
  created_at            DateTime          @default(now())
  updated_at            DateTime          @default(now()) @updatedAt
  consultant_id         String?
  hrm8_user_id          String?
  stripe_account_id     String?
  stripe_account_status String?
  stripe_onboarded_at   DateTime?
  stripe_refresh_url    String?
  stripe_return_url     String?
  company               Company?          @relation(fields: [company_id], references: [id], onDelete: Cascade)
  consultant            Consultant?       @relation(fields: [consultant_id], references: [id], onDelete: Cascade)
  hrm8_user             HRM8User?         @relation(fields: [hrm8_user_id], references: [id], onDelete: Cascade)

  @@index([company_id])
  @@index([hrm8_user_id])
  @@index([consultant_id])
  @@index([status])
  @@index([type])
}

model JobHiringTeamMember {
  id           String                    @id @default(uuid())
  job_id       String                    @map("job_id")
  user_id      String?                   @map("user_id")
  email        String
  name         String?
  role         HiringTeamRole
  status       HiringTeamMemberStatus    @default(PENDING)
  invited_at   DateTime                  @default(now()) @map("invited_at")
  joined_at    DateTime?                 @map("joined_at")
  job          Job                       @relation(fields: [job_id], references: [id], onDelete: Cascade)
  user         User?                     @relation(fields: [user_id], references: [id])
  member_roles JobHiringTeamMemberRole[]

  @@index([job_id])
  @@index([user_id])
  @@index([email])
  @@map("job_hiring_team_member")
}

model JobHiringTeamMemberRole {
  id          String              @id @default(uuid())
  member_id   String              @map("member_id")
  job_role_id String              @map("job_role_id")
  created_at  DateTime            @default(now()) @map("created_at")
  job_role    JobRole             @relation(fields: [job_role_id], references: [id], onDelete: Cascade)
  member      JobHiringTeamMember @relation(fields: [member_id], references: [id], onDelete: Cascade)

  @@unique([member_id, job_role_id])
  @@index([member_id])
  @@index([job_role_id])
  @@map("job_hiring_team_member_role")
}

model Lead {
  id                         String                     @id @default(uuid())
  company_name               String
  email                      String
  phone                      String?
  website                    String?
  country                    String
  city                       String?
  state_province             String?
  region_id                  String?
  assigned_consultant_id     String?
  assigned_at                DateTime?
  assigned_by                String?
  assignment_mode            AssignmentMode             @default(AUTO)
  assignment_source          AssignmentSource?
  created_by                 String?
  referred_by                String?
  lead_source                LeadSource                 @default(WEBSITE)
  status                     LeadStatus                 @default(NEW)
  notes                      String?
  tags                       String[]
  validated_by               String?
  validated_at               DateTime?
  attribution_locked         Boolean                    @default(false)
  converted_to_company_id    String?
  converted_at               DateTime?
  created_at                 DateTime                   @default(now())
  updated_at                 DateTime                   @default(now()) @updatedAt
  activity                   Activity[]
  consultant_lead_assignment ConsultantLeadAssignment[]
  consultant                 Consultant?                @relation("AssignedLeads", fields: [assigned_consultant_id], references: [id])
  company                    Company?                   @relation(fields: [converted_to_company_id], references: [id])
  creator                    Consultant?                @relation("CreatedLeads", fields: [created_by], references: [id])
  referrer                   Consultant?                @relation("ReferredLeads", fields: [referred_by], references: [id])
  region                     Region?                    @relation(fields: [region_id], references: [id])
  conversion_requests        LeadConversionRequest[]

  @@index([assigned_consultant_id])
  @@index([assignment_source])
  @@index([converted_to_company_id])
  @@index([created_by])
  @@index([region_id])
  @@index([status])
}

model LeadConversionRequest {
  id             String                  @id @default(uuid())
  lead_id        String                  @map("lead_id")
  consultant_id  String                  @map("consultant_id")
  region_id      String                  @map("region_id")
  status         ConversionRequestStatus @default(PENDING)
  company_name   String                  @map("company_name")
  email          String
  phone          String?
  website        String?
  country        String
  city           String?
  state_province String?                 @map("state_province")
  agent_notes    String?                 @map("agent_notes")
  reviewed_by    String?                 @map("reviewed_by")
  reviewed_at    DateTime?               @map("reviewed_at")
  admin_notes    String?                 @map("admin_notes")
  decline_reason String?                 @map("decline_reason")
  converted_at   DateTime?               @map("converted_at")
  company_id     String?                 @map("company_id")
  created_at     DateTime                @default(now()) @map("created_at")
  updated_at     DateTime                @updatedAt @map("updated_at")
  temp_password  String?                 @map("temp_password")
  company        Company?                @relation(fields: [company_id], references: [id])
  consultant     Consultant              @relation("ConversionRequests", fields: [consultant_id], references: [id])
  lead           Lead                    @relation(fields: [lead_id], references: [id], onDelete: Cascade)
  region         Region                  @relation(fields: [region_id], references: [id])
  reviewer       HRM8User?               @relation("ReviewedRequests", fields: [reviewed_by], references: [id])

  @@index([lead_id])
  @@index([consultant_id])
  @@index([region_id])
  @@index([status])
  @@index([reviewed_by])
  @@map("lead_conversion_requests")
}

model OfferDocument {
  id             String           @id @default(uuid())
  offer_id       String
  application_id String?
  name           String
  description    String?
  category       DocumentCategory
  status         DocumentStatus   @default(PENDING)
  file_url       String?
  file_name      String?
  uploaded_date  DateTime?
  uploaded_by    String?
  reviewed_by    String?
  reviewed_date  DateTime?
  review_notes   String?
  expiry_date    DateTime?
  is_required    Boolean          @default(true)
  template_url   String?
  created_at     DateTime         @default(now())
  updated_at     DateTime         @default(now()) @updatedAt
  application    Application?     @relation(fields: [application_id], references: [id], onDelete: Cascade)
  offer_letter   OfferLetter      @relation(fields: [offer_id], references: [id], onDelete: Cascade)

  @@index([application_id])
  @@index([category])
  @@index([is_required])
  @@index([offer_id])
  @@index([status])
}

model OfferLetter {
  id                  String             @id @default(uuid())
  application_id      String
  candidate_id        String
  job_id              String
  template_id         String?
  offer_type          String
  salary              Float
  salary_currency     String             @default("USD")
  salary_period       String
  start_date          DateTime
  benefits            String[]           @default([])
  bonus_structure     String?
  equity_options      String?
  work_location       String
  work_arrangement    String
  probation_period    Int?
  vacation_days       Int?
  custom_terms        Json?
  status              OfferStatus        @default(DRAFT)
  approval_workflow   Json?
  sent_date           DateTime?
  expiry_date         DateTime?
  responded_date      DateTime?
  decline_reason      String?
  signed_document_url String?
  generated_pdf_url   String?
  custom_message      String?
  created_by          String
  created_at          DateTime           @default(now())
  updated_at          DateTime           @default(now()) @updatedAt
  offer_document      OfferDocument[]
  application         Application        @relation(fields: [application_id], references: [id], onDelete: Cascade)
  candidate           Candidate          @relation(fields: [candidate_id], references: [id], onDelete: Cascade)
  user                User               @relation(fields: [created_by], references: [id], onDelete: Cascade)
  job                 Job                @relation(fields: [job_id], references: [id], onDelete: Cascade)
  offer_negotiation   OfferNegotiation[]

  @@index([application_id])
  @@index([candidate_id])
  @@index([created_by])
  @@index([expiry_date])
  @@index([job_id])
  @@index([sent_date])
  @@index([status])
}

model OfferNegotiation {
  id               String                 @id @default(uuid())
  offer_id         String
  message_type     NegotiationMessageType
  message          String
  proposed_changes Json?
  sender_id        String
  sender_type      String
  sender_name      String
  sender_email     String?
  responded        Boolean                @default(false)
  response         String?
  response_date    DateTime?
  created_at       DateTime               @default(now())
  updated_at       DateTime               @default(now()) @updatedAt
  offer_letter     OfferLetter            @relation(fields: [offer_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([message_type])
  @@index([offer_id])
  @@index([sender_id])
}

model Opportunity {
  id                  String           @id @default(uuid())
  company_id          String
  name                String
  type                OpportunityType
  stage               OpportunityStage @default(NEW)
  amount              Float?
  currency            String           @default("USD")
  probability         Int              @default(0)
  expected_close_date DateTime?
  sales_agent_id      String?
  referred_by         String?
  description         String?
  tags                String[]
  lost_reason         String?
  closed_at           DateTime?
  created_at          DateTime         @default(now())
  updated_at          DateTime         @default(now()) @updatedAt
  activity            Activity[]
  company             Company          @relation(fields: [company_id], references: [id], onDelete: Cascade)
  consultant          Consultant?      @relation(fields: [sales_agent_id], references: [id])

  @@index([company_id])
  @@index([sales_agent_id])
  @@index([stage])
  @@index([type])
}

model Subscription {
  id                     String               @id @default(uuid())
  company_id             String
  name                   String
  plan_type              SubscriptionPlanType @map("planType")
  status                 SubscriptionStatus   @default(ACTIVE)
  base_price             Float
  currency               String               @default("USD")
  billing_cycle          BillingCycle         @default(MONTHLY)
  discount_percent       Float?               @default(0)
  custom_pricing         Json?
  start_date             DateTime
  end_date               DateTime?
  renewal_date           DateTime?
  cancelled_at           DateTime?
  sales_agent_id         String?
  referred_by            String?
  usage_data             Json?
  notes                  String?
  created_at             DateTime             @default(now())
  updated_at             DateTime             @default(now()) @updatedAt
  auto_renew             Boolean              @default(true) @map("auto_renew")
  job_quota              Int?                 @map("job_quota")
  jobs_used              Int                  @default(0) @map("jobs_used")
  prepaid_balance        Float?               @default(0) @map("prepaid_balance")
  renewal_failed_at      DateTime?            @map("renewal_failed_at")
  renewal_failure_reason String?              @map("renewal_failure_reason")
  bill                   Bill[]
  commissions            Commission[]         @relation("SubscriptionCommissions")
  company                Company              @relation(fields: [company_id], references: [id], onDelete: Cascade)
  consultant             Consultant?          @relation(fields: [sales_agent_id], references: [id])

  @@index([company_id])
  @@index([plan_type])
  @@index([sales_agent_id])
  @@index([status])
}

model AssessmentComment {
  id            String     @id @default(uuid())
  assessment_id String
  user_id       String
  comment       String
  created_at    DateTime   @default(now())
  updated_at    DateTime   @default(now()) @updatedAt
  assessment    Assessment @relation(fields: [assessment_id], references: [id], onDelete: Cascade)
  user          User       @relation(fields: [user_id], references: [id])

  @@index([assessment_id])
  @@index([user_id])
}

model AssessmentGrade {
  id                     String             @id @default(uuid())
  assessment_response_id String
  user_id                String
  score                  Float?
  comment                String?
  created_at             DateTime           @default(now())
  updated_at             DateTime           @default(now()) @updatedAt
  assessment_response    AssessmentResponse @relation(fields: [assessment_response_id], references: [id], onDelete: Cascade)
  user                   User               @relation(fields: [user_id], references: [id])

  @@unique([assessment_response_id, user_id])
  @@index([assessment_response_id])
  @@index([user_id])
}

model EmailMessage {
  id             String         @id @default(uuid())
  template_id    String?
  application_id String?
  candidate_id   String
  job_id         String
  job_round_id   String?
  to             String
  cc             String[]       @default([])
  bcc            String[]       @default([])
  subject        String
  body           String
  status         EmailStatus    @default(SENT)
  sent_at        DateTime       @default(now())
  delivered_at   DateTime?
  opened_at      DateTime?
  bounced_at     DateTime?
  error_message  String?
  sender_id      String
  sender_email   String
  application    Application?   @relation(fields: [application_id], references: [id])
  job            Job            @relation(fields: [job_id], references: [id], onDelete: Cascade)
  email_template EmailTemplate? @relation(fields: [template_id], references: [id])

  @@index([application_id])
  @@index([candidate_id])
  @@index([job_id])
  @@index([job_round_id])
  @@index([sender_id])
  @@index([sent_at])
  @@index([status])
}

model EmailTemplate {
  id                     String                 @id @default(uuid())
  company_id             String
  job_id                 String?
  job_round_id           String?
  name                   String
  type                   EmailTemplateType
  subject                String
  body                   String
  variables              String[]               @default([])
  is_active              Boolean                @default(true)
  is_default             Boolean                @default(false)
  is_ai_generated        Boolean                @default(false)
  version                Int                    @default(1)
  created_by             String
  created_at             DateTime               @default(now())
  updated_at             DateTime               @default(now()) @updatedAt
  attachments            Json?                  @map("attachments")
  email_message          EmailMessage[]
  company                Company                @relation(fields: [company_id], references: [id], onDelete: Cascade)
  user                   User                   @relation(fields: [created_by], references: [id], onDelete: Cascade)
  job                    Job?                   @relation(fields: [job_id], references: [id], onDelete: Cascade)
  job_round              JobRound?              @relation(fields: [job_round_id], references: [id], onDelete: Cascade)
  email_template_trigger EmailTemplateTrigger[]

  @@index([company_id])
  @@index([created_by])
  @@index([job_id])
  @@index([job_round_id])
  @@index([type])
}

model EmailTemplateTrigger {
  id                String        @id @default(uuid())
  template_id       String
  job_round_id      String
  trigger_type      TriggerType
  trigger_condition Json?
  delay_days        Int?          @default(0)
  delay_hours       Int?          @default(0)
  scheduled_time    String?
  is_active         Boolean       @default(true)
  created_at        DateTime      @default(now())
  updated_at        DateTime      @default(now()) @updatedAt
  job_round         JobRound      @relation(fields: [job_round_id], references: [id], onDelete: Cascade)
  email_template    EmailTemplate @relation(fields: [template_id], references: [id], onDelete: Cascade)

  @@index([job_round_id])
  @@index([template_id])
}

model ResumeAnnotation {
  id               String          @id @default(uuid())
  resume_id        String
  user_id          String
  user_name        String
  user_color       String
  type             String
  text             String
  comment          String?
  position         Json
  created_at       DateTime        @default(now())
  candidate_resume CandidateResume @relation(fields: [resume_id], references: [id], onDelete: Cascade)

  @@index([resume_id])
}

model Product {
  id          String          @id @default(uuid())
  name        String
  code        String          @unique
  description String?
  is_active   Boolean         @default(true) @map("isActive")
  created_at  DateTime        @default(now()) @map("created_at")
  updated_at  DateTime        @default(now()) @updatedAt @map("updated_at")
  category    ProductCategory
  tiers       PriceTier[]

  @@index([is_active])
}

model PriceBook {
  id          String      @id @default(uuid())
  name        String
  description String?
  is_global   Boolean     @default(false) @map("is_global")
  region_id   String?     @map("region_id")
  currency    String      @default("USD")
  is_active   Boolean     @default(true) @map("is_active")
  created_at  DateTime    @default(now()) @map("created_at")
  updated_at  DateTime    @default(now()) @updatedAt @map("updated_at")
  companies   Company[]
  region      Region?     @relation(fields: [region_id], references: [id])
  tiers       PriceTier[]

  @@index([region_id])
  @@index([is_global])
}

model PriceTier {
  id            String    @id @default(uuid())
  price_book_id String    @map("price_book_id")
  product_id    String    @map("product_id")
  name          String
  min_quantity  Int       @default(1) @map("min_quantity")
  max_quantity  Int?      @map("max_quantity")
  unit_price    Float     @map("unit_price")
  period        String    @default("MONTHLY")
  created_at    DateTime  @default(now()) @map("created_at")
  updated_at    DateTime  @default(now()) @updatedAt @map("updated_at")
  price_book    PriceBook @relation(fields: [price_book_id], references: [id], onDelete: Cascade)
  product       Product   @relation(fields: [product_id], references: [id])

  @@index([price_book_id])
  @@index([product_id])
}

model PromoCode {
  id             String    @id @default(uuid())
  code           String    @unique
  description    String?
  discount_type  String    @map("discountType")
  discount_value Float     @map("discount_value")
  start_date     DateTime  @map("start_date")
  end_date       DateTime? @map("end_date")
  max_uses       Int?      @map("max_uses")
  used_count     Int       @default(0) @map("used_count")
  is_active      Boolean   @default(true) @map("is_active")
  created_at     DateTime  @default(now()) @map("created_at")
  updated_at     DateTime  @default(now()) @updatedAt @map("updated_at")

  @@index([code])
  @@index([is_active])
}

model GlobalIntegration {
  id           String   @id @default(uuid())
  provider     String   @unique
  name         String
  category     String
  api_key      String?  @map("api_key")
  api_secret   String?  @map("api_secret")
  endpoint_url String?  @map("endpoint_url")
  config       Json?
  is_active    Boolean  @default(true) @map("is_active")
  created_at   DateTime @default(now()) @map("created_at")
  updated_at   DateTime @default(now()) @updatedAt @map("updated_at")

  @@index([provider])
}

model Settlement {
  id             String           @id @default(uuid())
  licensee_id    String           @map("licensee_id")
  period_start   DateTime         @map("period_start")
  period_end     DateTime         @map("period_end")
  total_revenue  Float            @map("total_revenue")
  licensee_share Float            @map("licensee_share")
  hrm8_share     Float            @map("hrm8_share")
  status         String           @default("PENDING")
  payment_date   DateTime?        @map("payment_date")
  reference      String?
  generated_at   DateTime         @default(now()) @map("generated_at")
  licensee       RegionalLicensee @relation(fields: [licensee_id], references: [id])

  @@index([licensee_id])
  @@index([status])
}

model DunningPolicy {
  id             String   @id @default(uuid())
  name           String
  days_overdue   Int      @map("days_overdue")
  action         String
  email_template String?  @map("email_template")
  is_active      Boolean  @default(true) @map("is_active")
  created_at     DateTime @default(now()) @map("created_at")
  updated_at     DateTime @default(now()) @updatedAt @map("updated_at")
}

model UniversalNotification {
  id             String                    @id @default(uuid())
  recipient_type NotificationRecipientType @map("recipient_type")
  recipient_id   String                    @map("recipient_id")
  type           UniversalNotificationType
  title          String
  message        String
  data           Json?
  job_id         String?                   @map("job_id")
  application_id String?                   @map("application_id")
  company_id     String?                   @map("company_id")
  lead_id        String?                   @map("lead_id")
  region_id      String?                   @map("region_id")
  action_url     String?                   @map("action_url")
  read           Boolean                   @default(false)
  read_at        DateTime?                 @map("read_at")
  created_at     DateTime                  @default(now()) @map("created_at")
  expires_at     DateTime                  @map("expires_at")

  @@index([recipient_type, recipient_id])
  @@index([recipient_id, read])
  @@index([created_at])
  @@index([expires_at])
  @@map("universal_notifications")
}

model JobAnalytics {
  id         String   @id @default(uuid())
  job_id     String
  event_type String
  source     String
  session_id String?
  ip_address String?
  user_agent String?
  referrer   String?
  created_at DateTime @default(now())
  job        Job      @relation(fields: [job_id], references: [id], onDelete: Cascade)

  @@index([job_id, event_type, created_at])
  @@index([created_at])
  @@index([session_id])
  @@map("job_analytics")
}

model TransactionRefundRequest {
  id                   String       @id @default(uuid())
  company_id           String       @map("company_id")
  transaction_id       String       @map("transaction_id")
  transaction_type     String       @map("transaction_type")
  amount               Float
  status               RefundStatus @default(PENDING)
  reason               String
  processed_by         String?      @map("processed_by")
  processed_at         DateTime?    @map("processed_at")
  payment_reference    String?      @map("payment_reference")
  admin_notes          String?      @map("admin_notes")
  rejection_reason     String?      @map("rejection_reason")
  rejected_at          DateTime?    @map("rejected_at")
  rejected_by          String?      @map("rejected_by")
  stripe_refund_id     String?      @map("stripe_refund_id")
  refund_initiated_at  DateTime?    @map("refund_initiated_at")
  refund_completed_at  DateTime?    @map("refund_completed_at")
  refund_failed_reason String?      @map("refund_failed_reason")
  created_at           DateTime     @default(now()) @map("created_at")
  updated_at           DateTime     @default(now()) @updatedAt @map("updated_at")
  company              Company      @relation(fields: [company_id], references: [id])

  @@index([company_id])
  @@index([status])
  @@index([created_at])
  @@index([processed_by])
  @@map("transaction_refund_requests")
}

model VirtualAccount {
  id            String               @id @default(uuid())
  owner_type    VirtualAccountOwner  @map("owner_type")
  owner_id      String               @map("owner_id")
  balance       Float                @default(0)
  total_credits Float                @default(0) @map("total_credits")
  total_debits  Float                @default(0) @map("total_debits")
  status        VirtualAccountStatus @default(ACTIVE)
  frozen_at     DateTime?            @map("frozen_at")
  frozen_reason String?              @map("frozen_reason")
  created_at    DateTime             @default(now()) @map("created_at")
  updated_at    DateTime             @default(now()) @updatedAt @map("updated_at")
  transactions  VirtualTransaction[]

  @@unique([owner_type, owner_id])
  @@index([owner_type, owner_id])
  @@index([status])
  @@map("virtual_accounts")
}

model VirtualTransaction {
  id                    String                 @id @default(uuid())
  virtual_account_id    String                 @map("virtual_account_id")
  type                  VirtualTransactionType
  amount                Float
  balance_after         Float                  @map("balance_after")
  direction             TransactionDirection
  description           String?
  metadata              Json?
  reference_type        String?                @map("reference_type")
  reference_id          String?                @map("reference_id")
  subscription_id       String?                @map("subscription_id")
  job_id                String?                @map("job_id")
  bill_id               String?                @map("bill_id")
  commission_id         String?                @map("commission_id")
  refund_request_id     String?                @map("refund_request_id")
  withdrawal_request_id String?                @map("withdrawal_request_id")
  counterparty_type     VirtualAccountOwner?   @map("counterparty_type")
  counterparty_id       String?                @map("counterparty_id")
  status                TransactionStatus      @default(COMPLETED)
  failed_reason         String?                @map("failed_reason")
  created_by            String?                @map("created_by")
  created_at            DateTime               @default(now()) @map("created_at")
  virtual_account       VirtualAccount         @relation(fields: [virtual_account_id], references: [id])

  @@index([virtual_account_id])
  @@index([type])
  @@index([reference_type, reference_id])
  @@index([created_at])
  @@index([status])
  @@index([direction])
  @@map("virtual_transactions")
}

model SystemSettings {
  id         String   @id @default(uuid())
  key        String   @unique
  value      Json
  is_public  Boolean  @default(false) @map("is_public")
  updated_at DateTime @default(now()) @updatedAt @map("updated_at")
  updated_by String?  @map("updated_by")

  @@index([key])
  @@map("system_settings")
}

model AuditLog {
  id                 String   @id @default(uuid())
  entity_type        String   @map("entity_type")
  entity_id          String   @map("entity_id")
  action             String
  performed_by       String   @map("performed_by")
  performed_at       DateTime @default(now()) @map("performed_at")
  ip_address         String?  @map("ip_address")
  performed_by_email String?  @default("unknown") @map("performed_by_email")
  performed_by_role  String?  @default("SYSTEM") @map("performed_by_role")
  changes            Json?
  user_agent         String?  @map("user_agent")
  description        String?

  @@index([entity_type])
  @@index([entity_id])
  @@index([performed_by])
  @@index([performed_at])
  @@map("audit_logs")
}

model UserNotificationPreferences {
  id                String   @id @default(uuid())
  user_id           String   @unique @map("user_id")
  event_preferences Json     @map("event_preferences")
  quiet_hours       Json?    @map("quiet_hours")
  created_at        DateTime @default(now()) @map("created_at")
  updated_at        DateTime @default(now()) @updatedAt @map("updated_at")
  user              User     @relation("UserNotificationPreferences", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("user_notification_preferences")
}

model UserAlertRule {
  id          String   @id @default(uuid())
  user_id     String   @map("user_id")
  name        String
  description String?
  enabled     Boolean  @default(true)
  event_type  String   @map("event_type")
  conditions  Json
  actions     Json
  created_at  DateTime @default(now()) @map("created_at")
  updated_at  DateTime @default(now()) @updatedAt @map("updated_at")
  created_by  String   @map("created_by")
  user        User     @relation("UserAlertRules", fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([enabled])
  @@index([event_type])
  @@map("user_alert_rules")
}

model CandidateEvaluation {
  id             String              @id @default(uuid())
  application_id String              @map("application_id")
  user_id        String              @map("user_id")
  score          Float?
  comment        String?
  decision       EvaluationDecision?
  created_at     DateTime            @default(now()) @map("created_at")
  updated_at     DateTime            @default(now()) @updatedAt @map("updated_at")
  application    Application         @relation(fields: [application_id], references: [id], onDelete: Cascade)
  user           User                @relation(fields: [user_id], references: [id])

  @@unique([application_id, user_id])
  @@index([application_id])
}

enum HiringTeamRole {
  ADMIN
  SHORTLISTING
  MEMBER
}

enum HiringTeamMemberStatus {
  ACTIVE
  PENDING
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  USER
  VISITOR
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING_VERIFICATION
  INVITED
}

enum CompanyVerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum CompanyProfileStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

enum CompanyProfileSection {
  BASIC_DETAILS
  PRIMARY_LOCATION
  PERSONAL_PROFILE
  TEAM_MEMBERS
  BILLING
  BRANDING
}

enum CareersPageStatus {
  PENDING
  SUBMITTED
  APPROVED
  REJECTED
}

enum VerificationMethod {
  EMAIL_DOMAIN_CHECK
  VERIFICATION_EMAIL
  MANUAL_VERIFICATION
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum JobInvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum SignupRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum JobStatus {
  DRAFT
  OPEN
  CLOSED
  ON_HOLD
  FILLED
  TEMPLATE
  CANCELLED
}

enum JobSetupType {
  SIMPLE
  ADVANCED
}

enum HiringMode {
  SELF_MANAGED
  SHORTLISTING
  FULL_SERVICE
  EXECUTIVE_SEARCH
  ASSESSMENT_ONLY
}

enum WorkArrangement {
  ON_SITE
  REMOTE
  HYBRID
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  CASUAL
}

enum TemplateCategory {
  ENGINEERING
  PRODUCT
  DESIGN
  MARKETING
  SALES
  OPERATIONS
  HR
  FINANCE
  EXECUTIVE
  OTHER
}

enum CandidateStatus {
  ACTIVE
  INACTIVE
  PENDING_VERIFICATION
}

enum ApplicationStatus {
  NEW
  SCREENING
  INTERVIEW
  OFFER
  HIRED
  REJECTED
  WITHDRAWN
}

enum ApplicationStage {
  NEW_APPLICATION
  RESUME_REVIEW
  PHONE_SCREEN
  TECHNICAL_INTERVIEW
  ONSITE_INTERVIEW
  OFFER_EXTENDED
  OFFER_ACCEPTED
  REJECTED
}

enum AssessmentStatus {
  PENDING_INVITATION
  INVITED
  IN_PROGRESS
  COMPLETED
  EXPIRED
  CANCELLED
}

enum AssessmentType {
  PERSONALITY
  COGNITIVE
  SKILLS_BASED
  TECHNICAL
  BEHAVIORAL
}

enum AvailabilityStatus {
  AVAILABLE
  AT_CAPACITY
  UNAVAILABLE
}

enum CommissionStatus {
  PENDING
  CONFIRMED
  PAID
  CANCELLED
}

enum CommissionType {
  PLACEMENT
  SUBSCRIPTION_SALE
  RECRUITMENT_SERVICE
  CUSTOM
}

enum WithdrawalStatus {
  PENDING
  APPROVED
  PROCESSING
  COMPLETED
  REJECTED
  CANCELLED
}

enum RefundStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
  CANCELLED
}

enum ConsultantRole {
  RECRUITER
  SALES_AGENT
  CONSULTANT_360
}

enum ConsultantStatus {
  ACTIVE
  ON_LEAVE
  INACTIVE
  SUSPENDED
}

enum HRM8UserRole {
  GLOBAL_ADMIN
  REGIONAL_LICENSEE
}

enum HRM8UserStatus {
  ACTIVE
  SUSPENDED
  TERMINATED
}

enum InterviewStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
  NO_SHOW
}

enum LicenseeStatus {
  ACTIVE
  SUSPENDED
  TERMINATED
}

enum ManualScreeningStatus {
  PENDING
  PASSED
  FAILED
}

enum RegionOwnerType {
  HRM8
  LICENSEE
}

enum RevenueStatus {
  PENDING
  CONFIRMED
  PAID
}

enum ScreeningResultStatus {
  PASSED
  FAILED
  PENDING
  REVIEW_REQUIRED
}

enum ScreeningStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum ScreeningType {
  AUTOMATED
  MANUAL
}

enum VideoInterviewStatus {
  NOT_SCHEDULED
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum VideoInterviewType {
  PHONE
  VIDEO
  IN_PERSON
  TECHNICAL
  PANEL
}

enum JobRoundType {
  ASSESSMENT
  INTERVIEW
}

enum NotificationType {
  JOB_ALERT
  APPLICATION_UPDATE
  INTERVIEW_SCHEDULED
  MESSAGE
  SYSTEM
}

enum UniversalNotificationType {
  NEW_APPLICATION
  APPLICATION_STATUS_CHANGED
  APPLICATION_SHORTLISTED
  APPLICATION_REJECTED
  JOB_CREATED
  JOB_PUBLISHED
  JOB_STATUS_CHANGED
  JOB_ASSIGNED
  JOB_FILLED
  CANDIDATE_STAGE_CHANGED
  INTERVIEW_SCHEDULED
  OFFER_EXTENDED
  NEW_LEAD
  LEAD_CONVERTED
  SUBSCRIPTION_PURCHASED
  SERVICE_PURCHASED
  JOB_ASSIGNMENT_RECEIVED
  SHORTLIST_SUBMITTED
  SYSTEM_ANNOUNCEMENT
  NEW_MESSAGE
  JOB_ALERT
  REFUND_STATUS_CHANGED
  SUBSCRIPTION_RENEWAL_FAILED
  WITHDRAWAL_APPROVED
  WITHDRAWAL_REJECTED
  LOW_BALANCE_WARNING
  COMMISSION_EARNED
  LEAD_CONVERSION_REQUESTED
  LEAD_CONVERSION_DECLINED
}

enum NotificationRecipientType {
  USER
  CANDIDATE
  CONSULTANT
  HRM8_USER
}

enum JobAssignmentMode {
  AUTO_RULES_ONLY
  MANUAL_ONLY
}

enum AssignmentMode {
  AUTO
  MANUAL
}

enum AssignmentSource {
  AUTO_RULES
  MANUAL_EMPLOYER
  MANUAL_LICENSEE
  MANUAL_HRM8
  MANUAL_REASSIGNMENT
}

enum ConversationChannelType {
  CANDIDATE_EMPLOYER
  CANDIDATE_CONSULTANT
  SYSTEM
}

enum ConversationStatus {
  ACTIVE
  ARCHIVED
  CLOSED
}

enum FailCriteria {
  SCORE_BELOW_THRESHOLD
  RECOMMENDATION_NO
  RATING_CRITERIA_FAIL
  COMBINATION
}

enum InterviewFormat {
  LIVE_VIDEO
  PHONE
  IN_PERSON
  PANEL
}

enum InterviewRecommendation {
  STRONG_YES
  YES
  MAYBE
  NO
  STRONG_NO
}

enum MessageContentType {
  TEXT
  FILE
  SYSTEM
}

enum ParticipantType {
  CANDIDATE
  EMPLOYER
  CONSULTANT
  SYSTEM
}

enum PassCriteria {
  SCORE_THRESHOLD
  RECOMMENDATION
  RATING_CRITERIA
  COMBINATION
}

enum ScoringMethod {
  AVERAGE
  WEIGHTED
  CONSENSUS
}

enum PipelineStage {
  INTAKE
  SOURCING
  SCREENING
  SHORTLIST_SENT
  INTERVIEW
  OFFER
  PLACED
  ON_HOLD
  CLOSED
}

enum AccountTeamRole {
  SALES_OWNER
  RECRUITER_OWNER
  REGION_OWNER
}

enum ActivityType {
  EMAIL
  CALL
  MEETING
  NOTE
  TASK
  FOLLOW_UP
}

enum ActorType {
  CONSULTANT
  HRM8_USER
  SYSTEM
}

enum BillStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

enum BillingCycle {
  MONTHLY
  QUARTERLY
  ANNUAL
}

enum DocumentCategory {
  QUALIFICATION
  BACKGROUND_CHECK
  NDA
  IDENTITY
  TAX
  CONTRACT
  BANKING
  COMPLIANCE
  INSURANCE
  OTHER
}

enum DocumentStatus {
  PENDING
  REQUESTED
  SUBMITTED
  APPROVED
  REJECTED
  REVISION_REQUIRED
}

enum IntegrationStatus {
  ACTIVE
  INACTIVE
  ERROR
  PENDING_CONFIG
}

enum IntegrationType {
  JOB_POSTING_PLATFORM
  ASSESSMENT_TOOL
  ACCOUNTING_SYSTEM
  EMAIL_PROVIDER
  CALENDAR
  OTHER
  STRIPE_PAYMENTS
}

enum LeadSource {
  WEBSITE
  MARKETING_CAMPAIGN
  REFERRAL
  PARTNER_IMPORT
  MANUAL_ENTRY
  EVENT
  OTHER
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  CONVERTED
  LOST
  NURTURING
}

enum ConversionRequestStatus {
  PENDING
  APPROVED
  DECLINED
  CONVERTED
  CANCELLED
}

enum NegotiationMessageType {
  EMPLOYER_PROPOSAL
  CANDIDATE_COUNTER
  EMPLOYER_REVISION
  CANDIDATE_ACCEPTANCE
  CANDIDATE_DECLINE
}

enum OfferStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  SENT
  UNDER_NEGOTIATION
  ACCEPTED
  DECLINED
  EXPIRED
  WITHDRAWN
}

enum OpportunityStage {
  NEW
  QUALIFICATION
  PROPOSAL
  NEGOTIATION
  CLOSED_WON
  CLOSED_LOST
}

enum OpportunityType {
  SUBSCRIPTION
  RECRUITMENT_SERVICE
  CUSTOM
}

enum SubscriptionPlanType {
  FREE
  BASIC
  PROFESSIONAL
  ENTERPRISE
  CUSTOM
}

enum SubscriptionStatus {
  ACTIVE
  TRIAL
  SUSPENDED
  CANCELLED
  EXPIRED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum EmailStatus {
  SENT
  DELIVERED
  OPENED
  BOUNCED
  FAILED
}

enum EmailTemplateType {
  APPLICATION_CONFIRMATION
  INTERVIEW_INVITATION
  REJECTION
  OFFER_EXTENDED
  OFFER_ACCEPTED
  STAGE_CHANGE
  REMINDER
  FOLLOW_UP
  CUSTOM
  NEW
  ASSESSMENT
  INTERVIEW
  OFFER
  HIRED
}

enum TriggerType {
  IMMEDIATE
  SCHEDULED
  CONDITIONAL
}

enum VirtualAccountOwner {
  COMPANY
  CONSULTANT
  SALES_AGENT
  HRM8_GLOBAL
}

enum VirtualAccountStatus {
  ACTIVE
  FROZEN
  CLOSED
}

enum VirtualTransactionType {
  SUBSCRIPTION_PURCHASE
  SUBSCRIPTION_REFUND
  JOB_POSTING_DEDUCTION
  JOB_REFUND
  COMMISSION_EARNED
  COMMISSION_WITHDRAWAL
  ADDON_SERVICE_CHARGE
  ADDON_SERVICE_REFUND
  ADMIN_ADJUSTMENT
  PLATFORM_FEE
  TRANSFER_IN
  TRANSFER_OUT
  ASSESSMENT_CREDIT_DEDUCTION
  ASSESSMENT_CREDIT_REFUND
}

enum TransactionDirection {
  CREDIT
  DEBIT
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  REVERSED
}

enum EvaluationDecision {
  APPROVE
  REJECT
  PENDING
}

enum ProductCategory {
  SUBSCRIPTION
  JOB_POSTING
  ASSESSMENT
  ADDON_SERVICE
  FEATURE_UNLOCK
  SUPPORT
  OTHER
}
